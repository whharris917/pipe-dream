version: '3.8'

services:
  claude-agent:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      # Production QMS (read-only)
      - ../:/pipe-dream:ro
      # Workspace (read-write overlay)
      - ../.claude/users/claude/workspace:/pipe-dream/.claude/users/claude/workspace:rw
      # Sessions (read-write overlay) - added per CR-046
      - ../.claude/sessions:/pipe-dream/.claude/sessions:rw
      # MCP config overlay - container SSE config over local stdio config - added per CR-046
      - ./.mcp.json:/pipe-dream/.mcp.json:ro
      # SSH keys (read-only)
      - ~/.ssh:/.ssh:ro
      # Claude Code credentials (read-only) - added per CR-043-VAR-001
      - ~/.claude/.credentials.json:/.claude/.credentials.json:ro
    environment:
      - HOME=/
    extra_hosts:
      - "host.docker.internal:host-gateway"  # Linux compatibility
    stdin_open: true
    tty: true
