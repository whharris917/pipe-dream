---
doc_id: SOP-001
title: Quality Management System - Document Control
version: '1.0'
status: EFFECTIVE
document_type: SOP
executable: false
responsible_user: claude
checked_out: true
checked_out_date: 2026-01-02
effective_version: null
supersedes: null
review_history:
- round: 1
  type: REVIEW
  date_initiated: '2026-01-02'
  assignees:
  - user: qa
    status: COMPLETE
    date: '2026-01-02'
    comments: Approved. Comprehensive coverage of QMS requirements.
  - user: lead
    status: COMPLETE
    date: '2026-01-02'
    comments: Excellent draft. Clear and comprehensive.
approval_history:
- round: 1
  type: APPROVAL
  date_initiated: '2026-01-02'
  assignees:
  - user: qa
    status: APPROVED
    date: '2026-01-02'
    comments: null
  - user: lead
    status: APPROVED
    date: '2026-01-02'
    comments: null
---

# SOP-001: Quality Management System - Document Control

**Version:** 0.1 (DRAFT)
**Effective Date:** TBD
**Responsible User:** claude

---

## 1. Purpose

This Standard Operating Procedure (SOP) establishes the document control system for the Flow State project. It defines the structure, workflows, and requirements for creating, reviewing, approving, and maintaining controlled documents within the Quality Management System (QMS).

---

## 2. Scope

This SOP applies to all controlled documents within the Flow State QMS, including:

- Standard Operating Procedures (SOP)
- Change Records (CR)
- Investigations (INV)
- Corrective and Preventive Actions (CAPA)
- Test Protocols (TP)
- Exception Reports (ER)
- System Development Lifecycle Documents (RS, DS, CS, RTM, OQ)

This SOP applies to all authorized users of the QMS, including human users and AI agents.

---

## 3. Definitions

| Term | Definition |
|------|------------|
| **QMS** | Quality Management System - the document control infrastructure |
| **Controlled Document** | Any document managed under this SOP |
| **Responsible User** | The user who has checked out a document and owns its workflow |
| **Effective Version** | The approved version currently in force |
| **Draft** | A version under development, not yet approved |
| **Executable Document** | A document that authorizes implementation activities (CR, INV, CAPA, TP, ER) |
| **Non-Executable Document** | A document that defines requirements or specifications (RS, DS, CS, RTM, SOP, OQ) |

---

## 4. Responsibilities

### 4.1 Responsible User

The user who checks out a document becomes the Responsible User and shall:

- Maintain the document in their workspace during editing
- Initiate all workflow transitions (review, approval, release)
- Address reviewer comments before routing for approval
- Check in the document when editing is complete

### 4.2 Reviewers

Users assigned to review a document shall:

- Review the document for technical accuracy and completeness
- Provide comments via `qms review` command
- Complete reviews in a timely manner

### 4.3 Approvers

Users assigned to approve a document shall:

- Verify all review comments have been addressed
- Approve or reject the document via `qms approve` or `qms reject`
- Provide rejection rationale when rejecting

### 4.4 QA Representative

The QA user shall:

- Be assigned as approver on all controlled documents
- Verify procedural compliance before approval
- Maintain oversight of the QMS

---

## 5. QMS Structure

### 5.1 Directory Layout

```
pipe-dream/
├── .claude/users/                    # User workspaces and inboxes
│   ├── lead/
│   │   ├── workspace/
│   │   └── inbox/
│   ├── claude/
│   │   ├── workspace/
│   │   └── inbox/
│   ├── qa/
│   ├── bu/
│   ├── tu_input/
│   ├── tu_ui/
│   ├── tu_scene/
│   ├── tu_sketch/
│   └── tu_sim/
│
└── QMS/
    ├── .archive/                     # Historical versions
    │   ├── SOP/
    │   ├── CR/
    │   ├── INV/
    │   └── SDLC-FLOW/
    ├── SOP/                          # Standard Operating Procedures
    ├── CR/                           # Change Records
    ├── INV/                          # Investigations
    └── SDLC-FLOW/                    # System Lifecycle Documents
```

### 5.2 Document Naming Convention

| Document Type | Format | Example |
|---------------|--------|---------|
| Standard Operating Procedure | SOP-NNN | SOP-001 |
| Change Record | CR-NNN | CR-005 |
| Investigation | INV-NNN | INV-001 |
| CAPA (child of INV) | INV-NNN-CAPA-NNN | INV-001-CAPA-002 |
| Test Protocol (child of CR) | CR-NNN-TP | CR-005-TP |
| Exception Report (child of TP) | CR-NNN-TP-ER-NNN | CR-005-TP-ER-001 |
| Requirements Specification | SDLC-FLOW-RS | SDLC-FLOW-RS |
| Design Specification | SDLC-FLOW-DS | SDLC-FLOW-DS |
| Configuration Specification | SDLC-FLOW-CS | SDLC-FLOW-CS |
| Requirements Traceability Matrix | SDLC-FLOW-RTM | SDLC-FLOW-RTM |
| Operational Qualification | SDLC-FLOW-OQ | SDLC-FLOW-OQ |

### 5.3 File Naming

| State | Filename |
|-------|----------|
| Effective version | `{DOC_ID}.md` |
| Draft version | `{DOC_ID}-draft.md` |
| Archived version | `{DOC_ID}-v{N.X}.md` |

**Examples:**
- `SOP-001.md` — Effective version of SOP-001
- `SOP-001-draft.md` — Draft version being revised
- `.archive/SOP/SOP-001-v1.0.md` — Archived version 1.0

---

## 6. Version Control

### 6.1 Version Numbering

Versions follow the format `N.X` where:

- **N** = Approval number (major version)
- **X** = Revision number within approval cycle (minor version)

| Version | Meaning |
|---------|---------|
| v0.1 | Initial draft (never approved) |
| v0.2, v0.3... | Revisions during initial review cycle |
| v1.0 | First approval |
| v1.1, v1.2... | Revisions after re-opening v1.0 |
| v2.0 | Second approval |
| vN.0 | Nth approval |
| vN.X | Xth revision toward approval N+1 |

### 6.2 Version Transitions

| Action | Version Change |
|--------|----------------|
| Create new document | → v0.1 |
| Revise during review | v0.X → v0.(X+1) |
| First approval | v0.X → v1.0 |
| Re-open effective document | vN.0 → vN.1 |
| Subsequent approval | vN.X → v(N+1).0 |

### 6.3 Archive Management

When a document version is superseded:

1. The previous version is copied to `.archive/{TYPE}/`
2. The archive copy is renamed to include the version: `{DOC_ID}-v{N.X}.md`
3. The working directory retains only the current effective and/or draft versions

---

## 7. Document Status

### 7.1 Non-Executable Documents (SOP, RS, DS, CS, RTM, OQ)

| Status | Description |
|--------|-------------|
| DRAFT | Document is being created or revised |
| IN_REVIEW | Document is routed for review |
| REVIEWED | All assigned reviews are complete |
| IN_APPROVAL | Document is routed for approval |
| APPROVED | All assigned approvals are complete |
| EFFECTIVE | Document is approved and in force |
| SUPERSEDED | Document has been replaced by a newer version |

### 7.2 Executable Documents (CR, INV, CAPA, TP, ER)

| Status | Description |
|--------|-------------|
| DRAFT | Document is being created or revised |
| IN_PRE_REVIEW | Document is routed for pre-execution review |
| PRE_REVIEWED | All pre-reviews are complete |
| IN_PRE_APPROVAL | Document is routed for pre-execution approval |
| PRE_APPROVED | Document is approved for execution |
| IN_EXECUTION | Implementation/execution is in progress |
| IN_POST_REVIEW | Document is routed for post-execution review |
| POST_REVIEWED | All post-reviews are complete |
| IN_POST_APPROVAL | Document is routed for post-execution approval |
| POST_APPROVED | Execution verified and approved |
| CLOSED | Document is complete and closed |

---

## 8. Workflows

### 8.1 Review Workflow

Reviews must precede all approvals. Multiple review rounds are permitted.

**Initiating Review:**
```
qms route {DOC_ID} --review --assign {user1} {user2} ...
qms route {DOC_ID} --pre-review --assign {user1} {user2} ...    # Executable docs
qms route {DOC_ID} --post-review --assign {user1} {user2} ...   # After execution
```

**Completing Review:**
```
qms review {DOC_ID} --comment "Review comments here"
```

**Automatic Transition:** When all assigned reviewers complete their reviews, status transitions automatically:
- IN_REVIEW → REVIEWED
- IN_PRE_REVIEW → PRE_REVIEWED
- IN_POST_REVIEW → POST_REVIEWED

### 8.2 Approval Workflow

Approvals may only be initiated after a review workflow is complete.

**Initiating Approval:**
```
qms route {DOC_ID} --approval --assign {user1} {user2} ...
qms route {DOC_ID} --pre-approval --assign {user1} {user2} ...   # Executable docs
qms route {DOC_ID} --post-approval --assign {user1} {user2} ...  # After execution
```

**Approving:**
```
qms approve {DOC_ID}
```

**Rejecting:**
```
qms reject {DOC_ID} --comment "Rejection rationale"
```

**Automatic Transitions:**
- All approvals complete: IN_APPROVAL → APPROVED, IN_PRE_APPROVAL → PRE_APPROVED, etc.
- Any rejection: Returns to previous REVIEWED state for revision

### 8.3 Rejection Handling

When any approver rejects a document:

| From Status | Transitions To | Required Action |
|-------------|----------------|-----------------|
| IN_APPROVAL | REVIEWED | Revise, then re-route for review |
| IN_PRE_APPROVAL | PRE_REVIEWED | Revise, then re-route for pre-review |
| IN_POST_APPROVAL | POST_REVIEWED | Revise, then re-route for post-review |

The Responsible User must:
1. Address rejection comments
2. Check in the revised document
3. Route for another review cycle before re-routing for approval

### 8.4 Release Workflow (Executable Documents Only)

After pre-approval, executable documents must be manually released:

```
qms release {DOC_ID}
```

This transitions the document from PRE_APPROVED to IN_EXECUTION.

### 8.5 Revert Workflow (Executable Documents Only)

If problems are discovered after post-review, the document may revert to execution:

```
qms revert {DOC_ID} --reason "Reason for revert"
```

This transitions from POST_REVIEWED back to IN_EXECUTION.

### 8.6 Close Workflow (Executable Documents Only)

After post-approval, executable documents must be manually closed:

```
qms close {DOC_ID}
```

---

## 9. State Machine Diagrams

### 9.1 Non-Executable Documents

```
DRAFT
  │
  ▼ (qms route --review)
IN_REVIEW ◄─────────────────────┐
  │                             │
  ▼ (all reviews complete)      │ (another round)
REVIEWED ───────────────────────┘
  │
  ▼ (qms route --approval)
IN_APPROVAL
  │
  ├──► (all approve) ──► APPROVED ──► EFFECTIVE
  │
  └──► (any reject) ──► REVIEWED ──► [revise, re-review]
```

### 9.2 Executable Documents

```
DRAFT
  │
  ▼ (qms route --pre-review)
IN_PRE_REVIEW ◄─────────────────┐
  │                             │
  ▼ (all reviews complete)      │ (another round)
PRE_REVIEWED ───────────────────┘
  │
  ▼ (qms route --pre-approval)
IN_PRE_APPROVAL
  │
  ├──► (all approve) ──► PRE_APPROVED
  │                           │
  │                           ▼ (qms release)
  │                      IN_EXECUTION ◄─────────────────┐
  │                           │                         │
  │                           ▼ (qms route --post-review)
  │                      IN_POST_REVIEW ◄───────────┐   │
  │                           │                     │   │
  │                           ▼ (all reviews)       │   │
  │                      POST_REVIEWED ─────────────┘   │
  │                           │        (another round)  │
  │                           │                         │
  │                           ├──► (qms revert) ────────┘
  │                           │
  │                           ▼ (qms route --post-approval)
  │                      IN_POST_APPROVAL
  │                           │
  │                           ├──► (all approve) ──► POST_APPROVED ──► CLOSED
  │                           │
  │                           └──► (any reject) ──► POST_REVIEWED
  │
  └──► (any reject) ──► PRE_REVIEWED ──► [revise, re-review]
```

---

## 10. Check-Out / Check-In

### 10.1 Check-Out

To edit a document, a user must check it out:

```
qms checkout {DOC_ID}
```

Effects:
1. If an effective version exists, creates a new draft at version N.1
2. Document is copied to user's workspace
3. User becomes Responsible User
4. Document is locked; other users cannot edit

### 10.2 Check-In

To save changes back to the QMS:

```
qms checkin {DOC_ID}
```

Effects:
1. Document is copied from workspace to QMS working directory
2. Previous draft version (if any) is archived
3. Document remains checked out to user

### 10.3 Reading Documents

Any user may read documents without checking out:

```
qms read {DOC_ID}                    # Latest effective version
qms read {DOC_ID} --draft            # Current draft
qms read {DOC_ID} --version N.X      # Specific archived version
```

---

## 11. User Workspaces and Inboxes

### 11.1 Workspace

Each user has a workspace at `.claude/users/{username}/workspace/`

- Contains documents checked out by that user
- Only the workspace owner may edit documents within
- Documents must be checked in to be visible to others

### 11.2 Inbox

Each user has an inbox at `.claude/users/{username}/inbox/`

- Contains task files for assigned reviews and approvals
- Tasks are automatically created when documents are routed
- Tasks are removed when the user completes the action

**Task File Format:**
```yaml
---
task_id: task_001
task_type: REVIEW  # or APPROVAL
doc_id: CR-005
assigned_by: claude
assigned_date: 2026-01-02
due_date: null
---

Please review CR-005 for technical accuracy.
```

---

## 12. Frontmatter Schema

All controlled documents must include YAML frontmatter:

```yaml
---
doc_id: {DOC_ID}
title: {Document Title}
version: {N.X}
status: {STATUS}
document_type: {SOP|CR|INV|CAPA|TP|ER|RS|DS|CS|RTM|OQ}
executable: {true|false}

responsible_user: {username}
checked_out: {true|false}
checked_out_date: {YYYY-MM-DD|null}

effective_version: {N.X|null}
supersedes: {DOC_ID vN.X|null}

review_history:
  - round: 1
    reviewers:
      - user: {username}
        status: {PENDING|COMPLETE}
        date: {YYYY-MM-DD|null}
        comments: "{comments}"

approval_history:
  - round: 1
    type: {APPROVAL|PRE_APPROVAL|POST_APPROVAL}
    approvers:
      - user: {username}
        status: {PENDING|APPROVED|REJECTED}
        date: {YYYY-MM-DD|null}
        comments: "{comments}"
---
```

---

## 13. CLI Command Reference

| Command | Description |
|---------|-------------|
| `qms create {TYPE}` | Create a new document of specified type |
| `qms read {DOC_ID} [--draft] [--version N.X]` | Read a document |
| `qms checkout {DOC_ID}` | Check out document for editing |
| `qms checkin {DOC_ID}` | Check in document from workspace |
| `qms route {DOC_ID} --review --assign {users}` | Route for review |
| `qms route {DOC_ID} --pre-review --assign {users}` | Route for pre-review |
| `qms route {DOC_ID} --post-review --assign {users}` | Route for post-review |
| `qms route {DOC_ID} --approval --assign {users}` | Route for approval |
| `qms route {DOC_ID} --pre-approval --assign {users}` | Route for pre-approval |
| `qms route {DOC_ID} --post-approval --assign {users}` | Route for post-approval |
| `qms review {DOC_ID} --comment "{text}"` | Submit review |
| `qms approve {DOC_ID}` | Approve document |
| `qms reject {DOC_ID} --comment "{text}"` | Reject document |
| `qms release {DOC_ID}` | Release for execution (executable only) |
| `qms revert {DOC_ID} --reason "{text}"` | Revert to execution (executable only) |
| `qms close {DOC_ID}` | Close document (executable only) |
| `qms status {DOC_ID}` | Show document status and workflow state |
| `qms inbox` | List tasks in current user's inbox |
| `qms workspace` | List documents in current user's workspace |

---

## 14. References

- INV-2026-001: CR-2026-004 GMP Failure Investigation (historical context)

---

## 15. Revision History

| Version | Date | Author | Description |
|---------|------|--------|-------------|
| 0.1 | 2026-01-02 | claude | Initial draft |

---

**END OF DOCUMENT**
