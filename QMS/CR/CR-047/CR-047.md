---
title: MCP Server Streamable-HTTP Transport Support
revision_summary: Initial draft
---

# CR-047: MCP Server Streamable-HTTP Transport Support

## 1. Purpose

Add `streamable-http` transport support to the QMS MCP server, replacing the deprecated SSE transport. This enables reliable MCP connectivity from Docker containers to host-based MCP servers, which is essential for the containerized Claude agent architecture.

---

## 2. Scope

### 2.1 Context

During CR-046 execution, MCP connectivity testing revealed that Claude Code's SSE transport implementation has known issues in Docker environments. The official Claude Code documentation explicitly states: "The SSE (Server-Sent Events) transport is deprecated. Use HTTP servers instead, where available."

- **Parent Document:** CR-046 (Containerization Infrastructure Operational Verification)

### 2.2 Changes Summary

1. Add `streamable-http` transport option to `qms_mcp/server.py`
2. Update CLI help text and documentation
3. Update qualification tests to cover new transport

### 2.3 Files Affected

- `qms-cli/qms_mcp/server.py` - Add streamable-http transport support
- `qms-cli/qms_mcp/__main__.py` - Update usage documentation
- `qms-cli/tests/test_mcp_server.py` - Add transport qualification tests

---

## 3. Current State

The QMS MCP server supports two transport modes:
- `stdio` (default) - For local subprocess communication
- `sse` - For remote HTTP connections (deprecated by Anthropic)

SSE transport fails in Docker container environments due to known Claude Code bugs with EventSource implementation (Issues #18557, #20335, #3033, #4202).

---

## 4. Proposed State

The QMS MCP server supports three transport modes:
- `stdio` (default) - For local subprocess communication
- `sse` (deprecated) - Retained for backward compatibility
- `streamable-http` - Recommended transport for remote connections

Docker containers can reliably connect to host MCP servers using the streamable-http transport.

---

## 5. Change Description

### 5.1 Transport Implementation

Add `streamable-http` to the `--transport` choices in `server.py`:

```python
parser.add_argument(
    "--transport",
    choices=["stdio", "sse", "streamable-http"],
    default="stdio",
    help="Transport: stdio (default), sse (deprecated), or streamable-http (recommended for remote)",
)
```

Add the streamable-http branch in `main()`:

```python
elif args.transport == "streamable-http":
    # Streamable HTTP transport for remote connections (recommended)
    mcp.settings.host = args.host
    mcp.settings.port = args.port

    # Allow container connections via host.docker.internal
    mcp.settings.transport_security.allowed_hosts.append("host.docker.internal:*")
    mcp.settings.transport_security.allowed_origins.append(
        "http://host.docker.internal:*"
    )

    logger.info(f"Binding to {args.host}:{args.port}")
    mcp.run(transport="streamable-http")
```

### 5.2 Client Configuration

With streamable-http, clients connect using:

```bash
# From Claude Code CLI
claude mcp add --transport http qms http://host.docker.internal:8000/mcp

# Server startup
python -m qms_mcp --transport streamable-http --host 0.0.0.0 --port 8000 --project-root ..
```

Note: Claude Code CLI uses `--transport http` which maps to the `streamable-http` MCP transport.

---

## 6. Justification

- **SSE is deprecated:** Official Claude Code documentation recommends HTTP transport
- **Known bugs:** Multiple GitHub issues document SSE timeout failures in Docker
- **Blocking CR-046:** Container infrastructure cannot be verified without working MCP
- **Industry standard:** FastMCP 2.3+ made streamable-http the default transport

---

## 7. Impact Assessment

### 7.1 Files Affected

| File | Change Type | Description |
|------|-------------|-------------|
| `qms-cli/qms_mcp/server.py` | Modify | Add streamable-http transport |
| `qms-cli/qms_mcp/__main__.py` | Modify | Update usage documentation |
| `qms-cli/tests/test_mcp_server.py` | Modify | Add transport qualification tests |

### 7.2 Documents Affected

| Document | Change Type | Description |
|----------|-------------|-------------|
| SDLC-MCP-RS | Modify | Add REQ-MCP-014 for streamable-http |
| SDLC-MCP-RTM | Modify | Add verification for REQ-MCP-014 |

### 7.3 Other Impacts

- **CLAUDE.md:** Update MCP server startup documentation to recommend streamable-http
- **docker/README.md:** Update container MCP configuration examples

### 7.4 Development Controls

This CR implements changes to qms-cli, a controlled submodule. Development follows established controls:

1. **Test environment isolation:** Development in `.test-env/qms-cli/`
2. **Branch isolation:** All development on branch `cr-047-streamable-http`
3. **Write protection:** `.claude/settings.local.json` blocks direct writes to `qms-cli/`
4. **Qualification required:** All new/modified requirements must have passing tests before merge
5. **CI verification:** Tests must pass on GitHub Actions for dev branch
6. **PR gate:** Changes merge to main only via PR after RS/RTM approval
7. **Submodule update:** Parent repo updates pointer only after PR merge

### 7.5 Qualified State Continuity

| Phase | main branch | RS/RTM Status | Qualified Release |
|-------|-------------|---------------|-------------------|
| Before CR | Current commit (CR-045) | EFFECTIVE v5.0 | MCP-5.0 |
| During execution | Unchanged | DRAFT (checked out) | MCP-5.0 (unchanged) |
| Post-approval | Merged from cr-047-streamable-http | EFFECTIVE v6.0 | MCP-6.0 |

---

## 8. Testing Summary

- **Unit tests:** Transport argument parsing validates all three options
- **Integration tests:** Server starts successfully with streamable-http transport
- **Container tests:** Claude Code can connect from Docker container via streamable-http
- **Backward compatibility:** SSE transport still works (deprecated but functional)

---

## 9. Implementation Plan

### 9.1 Phase 1: Test Environment Setup

1. Verify `.test-env/` exists or create it
2. Clone/update qms-cli from GitHub into `.test-env/qms-cli/`
3. Create and checkout branch `cr-047-streamable-http`
4. Verify clean test environment with `pytest`

### 9.2 Phase 2: Requirements (RS Update)

1. Checkout SDLC-MCP-RS in production QMS
2. Add REQ-MCP-014: Streamable-HTTP transport support requirement
3. Checkin RS, route for review and approval

### 9.3 Phase 3: Implementation

1. Modify `qms_mcp/server.py` to add streamable-http transport
2. Update `qms_mcp/__main__.py` usage documentation
3. Test locally with both SSE and streamable-http transports
4. Commit to dev branch

### 9.4 Phase 4: Qualification

1. Add/update qualification tests in `tests/test_mcp_server.py`
2. Run full test suite, verify all tests pass
3. Push to dev branch
4. Verify GitHub Actions CI passes
5. Document qualified commit hash

### 9.5 Phase 5: RTM Update

1. Checkout SDLC-MCP-RTM in production QMS
2. Add verification evidence for REQ-MCP-014 referencing CI-verified commit
3. Checkin RTM, route for review and approval

### 9.6 Phase 6: Merge and Submodule Update

1. Once RS and RTM are EFFECTIVE, create PR to merge dev branch to main
2. Merge PR
3. Update submodule pointer in parent repo
4. Verify functionality in production context

### 9.7 Phase 7: Documentation Update

1. Update CLAUDE.md MCP server section to recommend streamable-http
2. Update docker/README.md with correct container configuration

---

## 10. Execution

| EI | Task Description | Execution Summary | Task Outcome | Performed By - Date |
|----|------------------|-------------------|--------------|---------------------|
| EI-1 | Test environment setup | Created .test-env/qms-cli, branch cr-047-streamable-http, verified 38 existing tests pass | Pass | claude - 2026-02-02 |
| EI-2 | RS update (add REQ-MCP-014) | SDLC-QMS-RS v6.0 EFFECTIVE with REQ-MCP-014, updated REQ-MCP-011/012 | Pass | claude - 2026-02-02 |
| EI-3 | Implementation | Modified server.py, __main__.py with streamable-http transport support | Pass | claude - 2026-02-02 |
| EI-4 | Qualification (tests + CI) | Added 4 new tests, 42 MCP tests pass, CI passed at commit 36d2b3e | Pass | claude - 2026-02-02 |
| EI-5 | RTM update | SDLC-QMS-RTM v7.0 EFFECTIVE with REQ-MCP-014 verification (155 total tests) | Pass | claude - 2026-02-02 |
| EI-6 | PR merge and submodule update | PR #5 merged, submodule updated to d071077 | Pass | claude - 2026-02-02 |
| EI-7 | Documentation update | Updated CLAUDE.md, docker/.mcp.json, docker/README.md, start-mcp-server.sh | Pass | claude - 2026-02-02 |

---

### Execution Comments

| Comment | Performed By - Date |
|---------|---------------------|
| All EIs completed successfully. Streamable-http transport now available in qms-cli. | claude - 2026-02-02 |

---

## 11. Execution Summary

All execution items completed successfully. The QMS MCP server now supports streamable-http transport (recommended) in addition to stdio (default) and sse (deprecated). The qualified baseline is:

- **SDLC-QMS-RS:** v6.0 (98 requirements including REQ-MCP-014)
- **SDLC-QMS-RTM:** v7.0 (155 tests, commit 36d2b3e)
- **qms-cli main:** commit d071077

Documentation updated to recommend streamable-http for all remote/container connections.

---

## 12. References

- **SOP-001:** Document Control
- **SOP-002:** Change Control
- **CR-046:** Containerization Infrastructure Operational Verification (parent)
- **SDLC-QMS-RS:** QMS CLI Requirements Specification (v6.0)
- **SDLC-QMS-RTM:** QMS CLI Requirements Traceability Matrix (v7.0)
- **Claude Code MCP Docs:** https://code.claude.com/docs/en/mcp
- **GitHub Issue #4202:** Docker MCP Tools Timeout
- **GitHub PR #5:** CR-047 implementation merge

---

**END OF DOCUMENT**
