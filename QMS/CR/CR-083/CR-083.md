---
title: Codify Merge Gate and Qualified Commit Convention
revision_summary: 'Execution complete: all 3 EIs pass'
---

# CR-083: Codify Merge Gate and Qualified Commit Convention

## 1. Purpose

Codify the merge gate requirements for SDLC-governed code changes. Currently, the SOPs describe *what* must be true before post-review but do not formally specify *when and how* code merges to main. This leaves three critical gaps:

1. **Merge type is unspecified.** Squash merges destroy commit hash continuity, making the RTM's qualified commit unreachable on main. The required merge type must be explicit.
2. **The qualified commit source is ambiguous.** The RTM records a commit hash, but no SOP states whether this is a dev branch commit, a main branch commit, or a merge commit. The convention must be formalized.
3. **The merge gate is implicit.** SOP-006 Section 7.4 requires RS/RTM to be EFFECTIVE before post-review, but doesn't explicitly gate the merge itself. The merge could theoretically happen before RS/RTM approval.

---

## 2. Scope

### 2.1 Context

This gap was discovered during CR-082 execution when a squash merge was inadvertently used instead of a regular merge commit. The squash merge created a new commit hash on main that differed from all dev branch commits, breaking the single-commit traceability that SOP-006 Section 7.2 requires.

Additionally, the to-do list item from 2026-01-26 ("Update SOP-005 to thoroughly explain qualification process") identified the same gap from a different angle: the full qualification workflow (dev branch, CI, RS, RTM, merge, post-review) was understood in practice but never formally documented.

- **Parent Document:** None (independent improvement, bundling to-do item from 2026-01-26)

### 2.2 Changes Summary

Update SOP-005 (Code Governance), SOP-006 (SDLC Governance), and TEMPLATE-CR to formally define:

- The merge type: regular merge commit (`--no-ff`), squash merges prohibited
- The qualified commit: the dev branch commit hash referenced in the CI-verified RTM
- The merge gate: RS and RTM must both be EFFECTIVE before merging to main

### 2.3 Files Affected

- `QMS/SOP/SOP-005.md` -- Section 7.1 rewrite: add merge requirements, qualification workflow
- `QMS/SOP/SOP-006.md` -- Section 7.2 and 7.4 updates: clarify qualified commit source and merge gate
- `QMS/TEMPLATE/TEMPLATE-CR.md` -- CODE CR PATTERNS and Phase 6 updates
- `qms-cli/seed/templates/TEMPLATE-CR.md` -- Seed copy alignment

---

## 3. Current State

SOP-005 Section 7.1 describes the execution branch model as a 5-step sequence (create branch, make changes, run tests, merge to main, document in CR) without specifying merge type, merge prerequisites, or the relationship between the dev branch commit and the RTM's qualified commit.

SOP-006 Section 7.2 requires that qualification be demonstrable at a "single git commit" but does not specify whether this commit lives on the dev branch or main. Section 7.4 gates post-review on RS/RTM being EFFECTIVE but does not explicitly gate the merge.

TEMPLATE-CR's CODE CR PATTERNS section states "RS and RTM must be EFFECTIVE before merging to main" and "RTM must reference the CI-verified commit hash from the dev branch" -- but these are template comments, not SOP requirements. The procedural backing in SOP-005 and SOP-006 is incomplete.

---

## 4. Proposed State

SOP-005 Section 7.1 explicitly defines the qualification workflow and merge gate: RS and RTM must be EFFECTIVE before code merges to main. The merge type is specified as a regular merge commit (`--no-ff`); squash merges are prohibited because they destroy commit hash continuity. The qualified commit is defined as the dev branch commit hash that CI verified and the RTM recorded.

SOP-006 Sections 7.2 and 7.4 are updated to reinforce that the qualified commit originates on the dev branch and is preserved on main via merge commit. The merge gate is an explicit prerequisite alongside the post-review prerequisite.

TEMPLATE-CR's Phase 6 codifies the merge type in the execution plan template, and the CODE CR PATTERNS section is updated for consistency.

---

## 5. Change Description

### 5.1 SOP-005 Section 7.1 -- Execution Branch Model

Rewrite the execution branch diagram and steps to include:

**Qualification on dev branch (before merge):**
- All tests pass on dev branch (CI-verified)
- The CI-verified commit hash is the **qualified commit**
- This commit hash is recorded in the RTM

**RS and RTM approval (before merge):**
- RS updated and routed through review/approval to EFFECTIVE
- RTM updated with the qualified commit hash, routed to EFFECTIVE
- Both must reach EFFECTIVE before proceeding to merge

**Merge to main:**
- Merge type: regular merge commit (`git merge --no-ff`)
- Squash merge (`--squash`) is **prohibited** -- it creates a new commit hash that has no relationship to the qualified commit in the RTM
- Fast-forward merge is acceptable only if the branch is a single commit (hash preserved), but `--no-ff` is preferred for auditability (merge commits clearly delineate CR boundaries in `git log`)

**New subsection: Why Merge Type Matters**

Brief rationale: the RTM records a specific commit hash. An auditor must be able to verify at that commit that all tests passed. If the hash was destroyed by a squash merge, the RTM references a phantom commit that never existed on main -- breaking the traceability chain.

### 5.2 SOP-006 Section 7.2 -- Single Commit Requirement

Add clarifying language specifying that the qualified commit shall be a commit on the execution branch (dev branch) where all tests passed as verified by CI. This commit is preserved on main via merge commit (`--no-ff`). The RTM shall reference this execution branch commit hash.

### 5.3 SOP-006 Section 7.4 -- CR Closure Prerequisite

Add a third requirement alongside the existing two:

> 3. Code changes shall not be merged to the main branch until both the RS and RTM are EFFECTIVE.

This makes the merge gate explicit rather than implied by the post-review gate.

### 5.4 TEMPLATE-CR Updates

**CODE CR PATTERNS comment block:**
- Add: "Merge type: regular merge commit (`--no-ff`). Squash merges are prohibited per SOP-005."
- Clarify: "The qualified commit is the dev branch commit verified by CI, not the merge commit."

**Phase 6 (Merge and Submodule Update):**
Update merge step to specify: "Merge PR using merge commit (not squash) -- preserves qualified commit hash on main"

---

## 6. Justification

- **Traceability integrity:** The RTM's qualified commit must be verifiable on main. Squash merges break this by creating phantom commits. This is not theoretical -- it happened on CR-082.
- **Audit readiness:** An auditor asking "show me the code state where all 403 tests passed" should be able to `git checkout <hash>` on main. With squash merge, that commit only exists as a GitHub artifact, not in the git history on main.
- **Process codification:** The qualification workflow has been practiced consistently across 13+ PRs but was never formally documented. Codifying it prevents regression and makes the process transferable.
- **To-do closure:** Resolves the 2026-01-26 to-do item "Update SOP-005 to thoroughly explain qualification process."

---

## 7. Impact Assessment

### 7.1 Files Affected

| File | Change Type | Description |
|------|-------------|-------------|
| `QMS/SOP/SOP-005.md` | Modify | Section 7.1 rewrite with merge requirements |
| `QMS/SOP/SOP-006.md` | Modify | Sections 7.2 and 7.4 updates |
| `QMS/TEMPLATE/TEMPLATE-CR.md` | Modify | CODE CR PATTERNS and Phase 6 |
| `qms-cli/seed/templates/TEMPLATE-CR.md` | Modify | Seed copy alignment |

### 7.2 Documents Affected

| Document | Change Type | Description |
|----------|-------------|-------------|
| SOP-005 | Modify | Section 7.1 rewrite |
| SOP-006 | Modify | Sections 7.2 and 7.4 |
| TEMPLATE-CR | Modify | Template comments and Phase 6 |

### 7.3 Other Impacts

None. This CR codifies existing practice -- it does not change the workflow, only documents it formally. No code changes, no SDLC impacts, no new requirements.

---

## 8. Testing Summary

No code changes. Verification is procedural:
- SOP-005 Section 7.1 clearly defines merge type, qualified commit, and merge gate
- SOP-006 Sections 7.2 and 7.4 are consistent with SOP-005
- TEMPLATE-CR reflects the SOP requirements in the template guidance
- Seed copy matches QMS copy

---

## 9. Implementation Plan

### 9.1 EI-1: Update SOP-005

1. Checkout SOP-005
2. Rewrite Section 7.1 with merge requirements, qualification workflow, and merge type rationale
3. Checkin, route for review and approval

### 9.2 EI-2: Update SOP-006

1. Checkout SOP-006
2. Update Section 7.2 (qualified commit source) and Section 7.4 (merge gate)
3. Checkin, route for review and approval

### 9.3 EI-3: Update TEMPLATE-CR

1. Checkout TEMPLATE-CR
2. Update CODE CR PATTERNS comment block and Phase 6
3. Checkin, route for review and approval
4. Update seed copy at `qms-cli/seed/templates/TEMPLATE-CR.md`

---

## 10. Execution

<!--
EXECUTION PHASE INSTRUCTIONS
============================
NOTE: Do NOT delete this comment block. It provides guidance for execution.

- Sections 1-9 are PRE-APPROVED content - do NOT modify during execution
- Only THIS TABLE and the comment sections below should be edited during execution phase

TASK OUTCOME:
- Pass: Task completed as planned
- Fail: Task could not be completed as planned - attach VAR with explanation
-->

| EI | Task Description | Execution Summary | Task Outcome | Performed By - Date |
|----|------------------|-------------------|--------------|---------------------|
| EI-1 | Update SOP-005 Section 7.1 with merge requirements and qualification workflow | Section 7.1 rewritten with subsections 7.1.1 (Workflow), 7.1.2 (Qualified Commit), 7.1.3 (Merge Gate and Merge Type), 7.1.4 (Why Merge Type Matters). QA requested dash formatting fix (-- to em-dash), corrected and re-reviewed. SOP-005 v4.0 EFFECTIVE. | Pass | claude - 2026-02-15 |
| EI-2 | Update SOP-006 Sections 7.2 and 7.4 with qualified commit source and merge gate | Section 7.2 updated with qualified commit source clarification (execution branch commit, preserved via --no-ff). Section 7.4 updated with explicit merge gate as requirement 3, plus rationale paragraph. SOP-006 v4.0 EFFECTIVE. | Pass | claude - 2026-02-15 |
| EI-3 | Update TEMPLATE-CR CODE CR PATTERNS and Phase 6; update seed copy | CODE CR PATTERNS updated with merge type, qualified commit definition, and SOP cross-references. Phase 6 updated with merge commit step and qualified commit verification step. Seed copy at qms-cli/seed/templates/TEMPLATE-CR.md aligned (also brought forward CR-051 Phase 5/6 improvements). TEMPLATE-CR v4.0 EFFECTIVE. | Pass | claude - 2026-02-15 |

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

Add rows as needed. When adding rows, fill columns 3-5 during execution.
-->

---

### Execution Comments

| Comment | Performed By - Date |
|---------|---------------------|
| QA identified dash formatting inconsistency in SOP-005 (double-hyphen vs em-dash). Fixed in the new Section 7.1 content only; code blocks and git flags left as-is. | claude - 2026-02-15 |
| Seed copy of TEMPLATE-CR was behind QMS copy (missing CR-051 Phase 5/6 improvements). Brought forward during EI-3 alignment. | claude - 2026-02-15 |

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

Record observations, decisions, or issues encountered during execution.
Add rows as needed.

This section is the appropriate place to attach VARs that do not apply
to any individual execution item, but apply to the CR as a whole.
-->

---

## 11. Execution Summary

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

Complete this section after all EIs are executed.
Summarize the overall outcome and any deviations from the plan.
-->

All 3 EIs completed successfully. SOP-005, SOP-006, and TEMPLATE-CR are all at v4.0 EFFECTIVE.

**Deliverables:**

| Document | Version | Change |
|----------|---------|--------|
| SOP-005 | v4.0 EFFECTIVE | Section 7.1 rewritten: workflow, qualified commit, merge gate/type, rationale |
| SOP-006 | v4.0 EFFECTIVE | Section 7.2 (commit source), Section 7.4 (merge gate) |
| TEMPLATE-CR | v4.0 EFFECTIVE | CODE CR PATTERNS and Phase 6 updated |
| Seed TEMPLATE-CR | Aligned | Matches QMS TEMPLATE-CR v4.0 |

No code changes, no SDLC impacts. Process-only CR. Closes the to-do item from 2026-01-26 ("Update SOP-005 to thoroughly explain qualification process").

---

## 12. References

- **SOP-001:** Document Control
- **SOP-002:** Change Control
- **SOP-005:** Code Governance (target of EI-1)
- **SOP-006:** Software Development Life Cycle Governance (target of EI-2)
- **CR-082:** ADD document type -- incident where squash merge broke commit hash continuity
- **To-do 2026-01-26:** "Update SOP-005 to thoroughly explain qualification process"

---

**END OF DOCUMENT**
