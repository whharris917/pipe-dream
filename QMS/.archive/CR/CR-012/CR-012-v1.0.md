---
title: Implement QA Review Safeguards (CAPA-002)
revision_summary: 'CR-012: Document execution results for QA review safeguards implementation'
---

# CR-012: Implement QA Review Safeguards (CAPA-002)

## 1. Purpose

This Change Record implements corrective and preventive actions from INV-002 (CAPA-002) to strengthen QA review behavior and prevent approval of non-compliant documents.

---

## 2. Scope

This CR modifies:

| File | Change Type | Description |
|------|-------------|-------------|
| `.claude/agents/qa.md` | Update | Add behavioral directives establishing binary compliance model |
| `.claude/qms.py` | Update | Inject mandatory checklist and structured review format into inbox tasks |

**Out of Scope:**
- Automated pre-validation (Proposal 5 from CAPA-002 analysis) - deferred to future CR
- Document-type-specific checklists - universal checklist for now

---

## 3. Rationale

INV-002 identified that SOP-005 was approved without the required `revision_summary` field. Root cause analysis revealed:

1. **No systematic verification**: QA review criteria were vague ("Document follows SOP format conventions")
2. **No explicit checklist**: Reviewers could approve without verifying specific fields
3. **No evidence requirement**: Reviews did not require quoting observed values

This CR implements Proposals 1-4 from the CAPA-002 analysis:
- **Proposal 1**: Mandatory Pre-Review Checklist (embedded in task prompts)
- **Proposal 2**: Structured Review Response Format (embedded in task prompts)
- **Proposal 3**: Review Prompt Injection (qms.py modifications)
- **Proposal 4**: QA Behavioral Directives (qa.md modifications)

---

## 4. Implementation Plan

### 4.1 qa.md Updates

Add new section "Behavioral Directives" establishing:
- Binary compliance model (compliant or non-compliant, no middle ground)
- Zero tolerance for any deficiency
- Evidence-based verification (quote actual values)
- Rejection as correct behavior
- No exceptions philosophy

Update "Review Criteria" section to require explicit verification with evidence.

### 4.2 qms.py Updates

Modify `cmd_route()` function to inject enhanced task content including:
- Mandatory verification checklist with specific items
- Structured review response format template
- Clear directive that ANY deficiency = REJECT

The injection will appear in inbox task files created during routing.

---

## 5. Testing Summary

- Manual verification that updated qa.md contains new behavioral directives
- Manual verification that routing creates tasks with enhanced prompts
- Functional test: route a document and verify inbox task contains checklist

---

## 6. Execution

| EI | Description | Status | Evidence | Follow-up |
|----|-------------|--------|----------|-----------|
| EI-1 | Update qa.md with behavioral directives | COMPLETE | Added "Behavioral Directives" section (6 subsections) and updated "Review Criteria" with evidence table. File: `.claude/agents/qa.md` | |
| EI-2 | Update qms.py with prompt injection | COMPLETE | Added `generate_review_task_content()` and `generate_approval_task_content()` functions. Updated `cmd_route()` and `cmd_assign()` to use enhanced task generation. File: `.claude/qms.py` | |
| EI-3 | Verify inbox task format | COMPLETE | Functional test via `generate_review_task_content()`: (1) MANDATORY VERIFICATION CHECKLIST present, (2) STRUCTURED REVIEW RESPONSE FORMAT present, (3) Reviewer identity dynamically set (e.g., "tu_sim Review: TEST-001"), (4) Critical reminders present, (5) Frontmatter verification items present. All 5 checks PASS. | |
| EI-4 | Fix cmd_assign to use .meta | COMPLETE | `cmd_assign()` was reading status from frontmatter instead of `.meta`, causing assignment failures. Updated to read from `.meta` (authoritative source). Lines 1230-1235. | Discovered during execution |
| EI-5 | Fix hardcoded "QA Review" in template | COMPLETE | Changed `## QA Review: {doc_id}` to `## {assignee} Review: {doc_id}` so reviewer identity is dynamic. Line 602. | Post-review finding |

---

**END OF DOCUMENT**
