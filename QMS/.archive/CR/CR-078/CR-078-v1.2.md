---
title: 'Phase A Integration Testing: Infrastructure Fixes'
revision_summary: 'EI-2: spawn_hub stdio null redirect'
---

# CR-078: Phase A Integration Testing: Infrastructure Fixes

## 1. Purpose

This CR authorizes fixes to Agent Hub infrastructure discovered during Phase A integration testing (regression verification). Findings are documented as they are discovered and fixed inline during testing.

---

## 2. Scope

### 2.1 Context

Phase A integration testing (per Session-2026-02-14-001 project plan) exercises the full Agent Hub stack: Docker containers, MCP servers, Hub CLI, and GUI. This CR captures infrastructure fixes required to complete that testing.

- **Parent Document:** None

### 2.2 Changes Summary

Fixes to Agent Hub infrastructure (Docker, entrypoint, MCP servers, Hub backend, GUI) as discovered during integration testing. Specific changes are documented in the Execution table as they are performed.

**Out of scope:** This CR does not modify any SDLC-governed controlled modules (qms-cli, flow-state). Changes to those systems would require a separate CR with detailed implementation plans approved before execution.

### 2.3 Files Affected

Agent Hub infrastructure files only. Specific files documented per execution item.

---

## 3. Current State

Phase A integration testing is underway. Infrastructure issues are discovered as the system is exercised end-to-end for the first time since the Feb 9-10 development sessions.

---

## 4. Proposed State

All infrastructure issues discovered during Phase A testing are resolved, enabling reliable multi-agent workflows.

---

## 5. Change Description

Changes are emergent — discovered during testing and documented in the Execution table. Each execution item describes the finding, root cause, and fix applied.

---

## 6. Justification

Integration testing cannot proceed if infrastructure bugs block the testing workflow. Inline fixes during testing are more efficient than creating individual CRs for each infrastructure fix, while still maintaining change control traceability.

---

## 7. Impact Assessment

### 7.1 Files Affected

Agent Hub infrastructure only. Specific files per execution item.

### 7.2 Documents Affected

| Document | Change Type | Description |
|----------|-------------|-------------|
| None | — | No controlled documents modified |

### 7.3 Other Impacts

Docker image rebuild required when entrypoint or Dockerfile changes are made.

---

## 8. Testing Summary

Each fix is verified by re-running the integration test step that discovered the issue. Overall verification is the successful completion of Phase A testing.

---

## 9. Implementation Plan

Fixes are applied as discovered during Phase A integration testing. Each fix is:

1. Identified during testing
2. Root-caused
3. Fixed in source
4. Verified by re-running the failing test step
5. Documented as an execution item in Section 10

---

## 10. Execution

<!--
EXECUTION PHASE INSTRUCTIONS
============================
NOTE: Do NOT delete this comment block. It provides guidance for execution.

- Sections 1-9 are PRE-APPROVED content - do NOT modify during execution
- Only THIS TABLE and the comment sections below should be edited during execution phase
-->

| EI | Task Description | Execution Summary | Task Outcome | Performed By - Date |
|----|------------------|-------------------|--------------|---------------------|
| 1 | Fix Claude Code ENOENT crash in container — `/claude-config/debug/` directory deleted during entrypoint cleanup but Claude Code expects it to exist | Root cause: `entrypoint.sh` deletes `/claude-config/debug/` at line 77 during ephemeral state cleanup, but Claude Code writes debug logs there at startup. Fix: Added `mkdir -p /claude-config/debug` after the cleanup section to recreate the directory. Docker image rebuilt with `--no-cache`. | PASS — Container launches cleanly, MCP connectivity verified end-to-end | claude - 2026-02-14 |
| 2 | Fix GUI `spawn_hub` crash — `agent-hub start` fails with `OSError: Bad file descriptor` when spawned from Tauri | Root cause: `lib.rs` spawns `agent-hub start` with `CREATE_NO_WINDOW` flag (Windows), which creates a process with no console and therefore no valid stdout/stderr handles. `click.echo()` in the Hub CLI crashes when writing to the invalid descriptors. Fix: Added `cmd.stdout(Stdio::null())` and `cmd.stderr(Stdio::null())` to redirect output to null before spawning. File: `agent-hub/gui/src-tauri/src/lib.rs`. | Pending retest — requires Tauri rebuild | claude - 2026-02-14 |

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

Add rows as needed. When adding rows, fill columns 3-5 during execution.
-->

---

### Execution Comments

| Comment | Performed By - Date |
|---------|---------------------|

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

Record observations, decisions, or issues encountered during execution.
Add rows as needed.
-->

---

## 11. Execution Summary

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

Complete this section after all EIs are executed.
Summarize the overall outcome and any deviations from the plan.
-->

[EXECUTION_SUMMARY]

---

## 12. References

- **SOP-001:** Document Control
- **SOP-002:** Change Control
- **SOP-004:** Document Execution
- **Session-2026-02-14-001:** Project plan (Phase A)

---

**END OF DOCUMENT**
