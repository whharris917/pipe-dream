---
title: Requalify SSE Transport (REQ-MCP-011/012/013)
revision_summary: Initial draft
---

# CR-045: Requalify SSE Transport (REQ-MCP-011/012/013)

## 1. Purpose

This CR requalifies the SSE transport feature (REQ-MCP-011/012/013) that was inadequately verified in CR-042. The original qualification tests validated CLI argument parsing but did not exercise the actual SSE transport startup code path. This CR adds integration tests that verify the transport actually starts and accepts connections, updating the RTM with valid verification evidence.

---

## 2. Scope

### 2.1 Context

This CR implements CAPA-001 from INV-008, which identified a qualification gap in CR-042's SSE transport implementation. The code was fixed during CR-043 execution (authorized via CR-043-VAR-002), but proper qualification testing was never performed.

- **Parent Document:** INV-008 (CAPA-001)

### 2.2 Changes Summary

- Add integration tests that exercise SSE transport startup
- Update RTM verification evidence for REQ-MCP-011/012/013
- Produce qualified release CLI-5.0

### 2.3 Files Affected

- `qms-cli/tests/qualification/test_mcp.py` - Add SSE transport integration tests
- `QMS/SDLC-QMS/SDLC-QMS-RTM.md` - Update verification evidence

---

## 3. Current State

1. REQ-MCP-011/012/013 are marked as PASS in RTM v5.0
2. Tests verify CLI argument parsing (`test_mcp_cli_args_sse_transport`, `test_mcp_transport_choices`)
3. No tests exercise the actual SSE transport startup code path
4. The code fix (using `mcp.settings.host/port` instead of kwargs) exists but was never formally qualified

---

## 4. Proposed State

1. REQ-MCP-011/012/013 verification evidence references integration tests that exercise actual SSE startup
2. Tests verify that the MCP server can start with SSE transport and configure host/port
3. RTM updated with valid test references at qualified commit
4. Qualified release: CLI-5.0

---

## 5. Change Description

### 5.1 Integration Tests

Add tests to `test_mcp.py` that exercise SSE transport startup:

**test_mcp_sse_transport_starts:**
- Verify that `mcp.run(transport="sse")` can be invoked without error when settings are configured
- Test that `mcp.settings.host` and `mcp.settings.port` are properly set before run()

**test_mcp_sse_transport_security_config:**
- Verify that transport security settings can be modified (allowed_hosts, allowed_origins)
- Test that `host.docker.internal` additions work correctly

### 5.2 RTM Update

Update Section 5.14 (Remote Transport) with:
- New test function references for SSE startup verification
- Updated qualified commit hash
- Revised test count reflecting new integration tests

---

## 6. Justification

- **Problem:** CR-042 verification tests did not exercise the code path that actually starts SSE transport, allowing a defect to pass qualification
- **Impact if not addressed:** The qualification gap undermines confidence in the RTM as proof that requirements are met
- **Solution:** Add integration tests that exercise the actual startup code, providing genuine verification evidence

---

## 7. Impact Assessment

### 7.1 Files Affected

| File | Change Type | Description |
|------|-------------|-------------|
| `qms-cli/tests/qualification/test_mcp.py` | Modify | Add SSE transport integration tests |

### 7.2 Documents Affected

| Document | Change Type | Description |
|----------|-------------|-------------|
| SDLC-QMS-RTM | Modify | Update verification evidence for REQ-MCP-011/012/013 |

### 7.3 Other Impacts

None. The code fix already exists (authorized via CR-043-VAR-002). This CR only adds proper qualification testing.

### 7.4 Development Controls

This CR implements changes to qms-cli, a controlled submodule. Development follows established controls:

1. **Test environment isolation:** Development in `.test-env/` or other gitignored location
2. **Branch isolation:** All development on branch `cr-045-sse-requalification`
3. **Write protection:** `.claude/settings.local.json` blocks direct writes to `qms-cli/`
4. **Qualification required:** All new tests must pass before merge
5. **CI verification:** Tests must pass on GitHub Actions for dev branch
6. **PR gate:** Changes merge to main only via PR after RTM approval
7. **Submodule update:** Parent repo updates pointer only after PR merge

### 7.5 Qualified State Continuity

| Phase | main branch | RS/RTM Status | Qualified Release |
|-------|-------------|---------------|-------------------|
| Before CR | Current commit | EFFECTIVE v5.0 | CLI-4.0 |
| During execution | Unchanged | DRAFT (RTM checked out) | CLI-4.0 (unchanged) |
| Post-approval | Merged from cr-045-sse-requalification | EFFECTIVE v6.0 | CLI-5.0 |

---

## 8. Testing Summary

- **test_mcp_sse_transport_configuration:** Verify settings can be configured for SSE transport (host, port, security)
- **test_mcp_sse_transport_security_allows_docker:** Verify host.docker.internal can be added to allowed hosts/origins
- All existing tests continue to pass (regression)

---

## 9. Implementation Plan

### 9.1 Phase 1: Test Environment Setup

1. Create `.test-env/qms-cli/` working directory
2. Clone qms-cli from GitHub
3. Create and checkout branch `cr-045-sse-requalification`
4. Verify existing tests pass

### 9.2 Phase 2: Requirements (RS Update)

Not applicable - requirements REQ-MCP-011/012/013 are correctly specified. Only verification was inadequate.

### 9.3 Phase 3: Implementation

1. Add SSE transport integration tests to `test_mcp.py`
2. Run tests locally to verify they pass
3. Commit to dev branch

### 9.4 Phase 4: Qualification

1. Run full test suite, verify all tests pass
2. Push to dev branch
3. Verify GitHub Actions CI passes
4. Document qualified commit hash

### 9.5 Phase 5: RTM Update

1. Checkout SDLC-QMS-RTM in production QMS
2. Update REQ-MCP-011/012/013 verification evidence with new test references
3. Update qualified baseline section (commit hash, test count)
4. Checkin RTM, route for review and approval

### 9.6 Phase 6: Merge and Submodule Update

1. Once RTM is EFFECTIVE, create PR to merge dev branch to main
2. Merge PR
3. Update submodule pointer in pipe-dream
4. Verify MCP server starts correctly with SSE transport

### 9.7 Phase 7: Documentation

Not applicable - no documentation changes required.

---

## 10. Execution

<!--
EXECUTION PHASE INSTRUCTIONS
============================
NOTE: Do NOT delete this comment block. It provides guidance for execution.

- Sections 1-9 are PRE-APPROVED content - do NOT modify during execution
- Only THIS TABLE and the comment sections below should be edited during execution phase

COLUMNS:
- EI: Execution item identifier
- Task Description: What to do (static, from Implementation Plan)
- Execution Summary: Narrative of what was done, evidence, observations (editable)
- Task Outcome: Pass or Fail (editable)
- Performed By - Date: Signature (editable)

TASK OUTCOME:
- Pass: Task completed as planned
- Fail: Task could not be completed as planned - attach VAR with explanation

VAR TYPES (see VAR-TEMPLATE):
- Type 1: Use when the failed task is critical to CR objectives
- Type 2: Use when impact is contained and CR can conceptually close

EXECUTION SUMMARY EXAMPLES:
- "Implemented per plan. Commit abc123."
- "Modified src/module.py:45-67. Unit tests passing."
- "Created SOP-007 (now EFFECTIVE)."
-->

| EI | Task Description | Execution Summary | Task Outcome | Performed By - Date |
|----|------------------|-------------------|--------------|---------------------|
| EI-1 | Set up test environment and create branch | [SUMMARY] | [Pass/Fail] | [PERFORMER] - [DATE] |
| EI-2 | Add SSE transport integration tests | [SUMMARY] | [Pass/Fail] | [PERFORMER] - [DATE] |
| EI-3 | Run qualification tests and push to dev branch | [SUMMARY] | [Pass/Fail] | [PERFORMER] - [DATE] |
| EI-4 | Update RTM with verification evidence | [SUMMARY] | [Pass/Fail] | [PERFORMER] - [DATE] |
| EI-5 | Merge to main and update submodule | [SUMMARY] | [Pass/Fail] | [PERFORMER] - [DATE] |

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

Add rows as needed. When adding rows, fill columns 3-5 during execution.
-->

---

### Execution Comments

| Comment | Performed By - Date |
|---------|---------------------|
| [COMMENT] | [PERFORMER] - [DATE] |

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

Record observations, decisions, or issues encountered during execution.
Add rows as needed.

This section is the appropriate place to attach VARs that do not apply
to any individual execution item, but apply to the CR as a whole.
-->

---

## 11. Execution Summary

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

Complete this section after all EIs are executed.
Summarize the overall outcome and any deviations from the plan.
-->

[EXECUTION_SUMMARY]

---

## 12. References

- **SOP-001:** Document Control
- **SOP-002:** Change Control
- **SOP-005:** Code Governance
- **SOP-006:** SDLC Governance
- **INV-008:** CR-042 SSE Transport Qualification Gap and CR-043 Unauthorized Modification
- **CR-042:** Add Remote Transport Support to QMS MCP Server
- **CR-043-VAR-002:** Unauthorized qms-cli Modification During Container Testing
- **SDLC-QMS-RS:** QMS CLI Requirements Specification
- **SDLC-QMS-RTM:** QMS CLI Requirements Traceability Matrix

---

**END OF DOCUMENT**
