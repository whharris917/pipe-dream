---
title: pd-status — Pipe Dream process overview utility
revision_summary: Initial draft
---

# CR-062: pd-status — Pipe Dream process overview utility

## 1. Purpose

Provide a single command to display the status of all Pipe Dream background processes: MCP servers, Agent Hub, and Docker containers. Currently, checking what's running requires manually combining `docker ps`, `netstat`, `ps`, and `curl` across multiple terminals.

---

## 2. Scope

### 2.1 Context

Independent improvement identified during development. Multiple background services accumulate across sessions (two MCP servers on :8000/:8001, Agent Hub on :9000, Docker containers for agents). These processes persist across Claude Code sessions and are easily forgotten or orphaned.

- **Parent Document:** None

### 2.2 Changes Summary

Create a standalone bash script `pd-status` in the project root that checks three layers: services (PID file + port probe), containers (docker ps), and stale PID detection.

### 2.3 Files Affected

- `pd-status` — New file. Standalone bash script for process overview.

---

## 3. Current State

No unified way to check Pipe Dream process status. Operators must manually run combinations of `docker ps`, `netstat`, `ps`, and `curl` to determine what's running.

---

## 4. Proposed State

A `pd-status` command in the project root provides a formatted overview of all Pipe Dream processes. Includes `--stop-all` flag for cleanup.

---

## 5. Change Description

### 5.1 Service Checks

For each of 3 services (QMS MCP :8000, Git MCP :8001, Agent Hub :9000):
1. Read PID from `.{service}.pid` file (if exists)
2. Check if that PID is alive (`kill -0`)
3. Probe the port for a listener (curl to health endpoint)
4. Cross-reference: if PID file says one thing but port says another, flag it
5. If Hub is reachable, query `GET /api/status` for agent summary

### 5.2 Container Checks

1. `docker ps -a --filter "name=agent-"` to list pipe-dream containers
2. Show name, state, and status string

### 5.3 Stale PID Detection

1. PID file exists but process is dead — stale
2. PID file PID doesn't match the process actually holding the port — mismatch
3. Report in a Warnings section

### 5.4 Stop-All Mode

`pd-status --stop-all` kills all pipe-dream services and removes containers, with confirmation prompt.

### 5.5 Output Format

Color-coded terminal output using the same color scheme as `launch.sh` (GREEN for running, RED for stopped, YELLOW for warnings, CYAN for headers).

---

## 6. Justification

- Reduces cognitive overhead when managing multi-service development sessions
- Prevents orphaned processes from consuming resources across sessions
- Reuses health check patterns already established in `launch.sh`
- Zero Python dependencies — works even when the environment is broken

---

## 7. Impact Assessment

### 7.1 Files Affected

| File | Change Type | Description |
|------|-------------|-------------|
| `pd-status` | Create | Standalone bash script for process overview |

### 7.2 Documents Affected

| Document | Change Type | Description |
|----------|-------------|-------------|
| CR-062 | Create | This Change Record |

### 7.3 Other Impacts

None. This is a standalone utility with no dependencies on or modifications to existing files.

---

## 8. Testing Summary

- Run `pd-status` with current services running — verify all 3 services show as RUNNING with correct PIDs
- Run `pd-status` with nothing running — verify all show STOPPED, no containers
- Run with a stale PID file — verify mismatch warning appears
- Run `pd-status --stop-all` — verify confirmation prompt and cleanup behavior

---

## 9. Implementation Plan

### 9.1 Phase 1: Script Creation

1. Create `pd-status` in project root
2. Implement service checks (PID files + port probes + health endpoints)
3. Implement container checks (docker ps filtering)
4. Implement stale PID detection and warnings
5. Implement `--stop-all` flag with confirmation

### 9.2 Phase 2: Verification

1. Test with current running services
2. Test with stopped services
3. Test stale PID scenarios
4. Test `--stop-all` behavior

---

## 10. Execution

| EI | Task Description | Execution Summary | Task Outcome | Performed By - Date |
|----|------------------|-------------------|--------------|---------------------|
| EI-1 | Create `pd-status` script per Change Description | [SUMMARY] | [Pass/Fail] | [PERFORMER] - [DATE] |
| EI-2 | Verify with running services | [SUMMARY] | [Pass/Fail] | [PERFORMER] - [DATE] |
| EI-3 | Verify with stopped services / stale PIDs | [SUMMARY] | [Pass/Fail] | [PERFORMER] - [DATE] |

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

Add rows as needed. When adding rows, fill columns 3-5 during execution.
-->

---

### Execution Comments

| Comment | Performed By - Date |
|---------|---------------------|
| [COMMENT] | [PERFORMER] - [DATE] |

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

Record observations, decisions, or issues encountered during execution.
Add rows as needed.

This section is the appropriate place to attach VARs that do not apply
to any individual execution item, but apply to the CR as a whole.
-->

---

## 11. Execution Summary

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

Complete this section after all EIs are executed.
Summarize the overall outcome and any deviations from the plan.
-->

[EXECUTION_SUMMARY]

---

## 12. References

- **SOP-001:** Document Control
- **SOP-002:** Change Control

---

**END OF DOCUMENT**
