---
title: Terminal Scrollback Support in Agent GUI
revision_summary: Initial draft
---

# CR-080: Terminal Scrollback Support in Agent GUI

## 1. Purpose

Enable users to scroll through terminal history in the Agent Hub GUI's xterm.js terminals. During Phase A.4 integration testing, terminal scrollback was identified as a usability gap — users cannot review previous output by scrolling up.

---

## 2. Scope

### 2.1 Context

Gap discovered during Phase A.4 integration testing (Session-2026-02-14-002). Tracked in PROJECT_STATE.md backlog under "GUI Polish."

- **Parent Document:** None

### 2.2 Changes Summary

Investigate and fix terminal scrollback in the xterm.js-based agent terminals. The scrollback buffer is already configured (`scrollback: 10000`), so the issue likely involves event handling, CSS, or Tauri webview interaction preventing mouse wheel scroll from reaching xterm.js.

### 2.3 Files Affected

- `agent-hub/gui/src/components/Terminal/TerminalView.tsx` - Potential scroll event or configuration fixes
- `agent-hub/gui/src/styles/global.css` - Potential CSS fixes for terminal container scrolling

---

## 3. Current State

The xterm.js terminal instances are configured with `scrollback: 10000` lines of buffer. However, users cannot scroll through terminal history to review previous output. The terminal container uses absolute positioning with `inset: 0` and `padding: 4px`.

---

## 4. Proposed State

Users can scroll through terminal history using the mouse wheel (and optionally keyboard shortcuts like Shift+PageUp/PageDown). Scrollback behavior works naturally within the xterm.js terminal viewport.

---

## 5. Change Description

### 5.1 Diagnosis

Identify what prevents scrolling from working. Likely candidates:

1. **CSS overflow:** The terminal container or its parent may have `overflow: hidden` preventing scroll events from reaching xterm.js
2. **Event interception:** The Tauri webview or a parent element may be consuming wheel events before xterm.js receives them
3. **xterm.js addon conflict:** The FitAddon's ResizeObserver may interfere with scroll behavior

### 5.2 Fix

Apply the minimum fix required based on diagnosis. This may involve:

- Adjusting CSS overflow properties on the terminal container
- Ensuring wheel events propagate to xterm.js
- Adding any missing xterm.js configuration

The fix scope is intentionally narrow — diagnose the specific blocker and resolve it.

---

## 6. Justification

- Terminal scrollback is a fundamental usability requirement for any terminal interface. Without it, users lose access to output that scrolls past the viewport.
- Agent sessions produce substantial output (Claude Code conversations, build output, test results). Reviewing this output is essential for monitoring agent behavior.
- The scrollback buffer is already allocated (10,000 lines) but inaccessible to the user, meaning the memory cost is already paid with no benefit.

---

## 7. Impact Assessment

### 7.1 Files Affected

| File | Change Type | Description |
|------|-------------|-------------|
| `agent-hub/gui/src/components/Terminal/TerminalView.tsx` | Modify | Scroll event handling or configuration |
| `agent-hub/gui/src/styles/global.css` | Modify | CSS adjustments if overflow is the blocker |

### 7.2 Documents Affected

| Document | Change Type | Description |
|----------|-------------|-------------|
| None | - | No controlled documents affected |

### 7.3 Other Impacts

None. This is a client-side GUI fix with no backend, protocol, or infrastructure changes.

---

## 8. Testing Summary

- Manual verification: launch an agent in the GUI, generate sufficient output to exceed the viewport, and confirm mouse wheel scrolling works to review previous output
- Verify that scrolling does not interfere with normal terminal input when at the bottom of the buffer
- Verify terminal resizing (via window resize or tab switching) still works correctly after the fix

---

## 9. Implementation Plan

### 9.1 Diagnosis

1. Launch the Agent Hub GUI with an active agent
2. Generate terminal output exceeding the viewport
3. Test mouse wheel scrolling — confirm the failure mode
4. Inspect DOM/CSS for overflow or event issues
5. Identify root cause

### 9.2 Implementation

1. Apply the minimum fix based on diagnosis
2. Test scrollback behavior manually
3. Verify no regression in terminal resize, tab switching, or input handling

### 9.3 Integration

1. Commit the fix
2. Document evidence in CR

---

## 10. Execution

<!--
EXECUTION PHASE INSTRUCTIONS
============================
NOTE: Do NOT delete this comment block. It provides guidance for execution.

- Sections 1-9 are PRE-APPROVED content - do NOT modify during execution
- Only THIS TABLE and the comment sections below should be edited during execution phase

COLUMNS:
- EI: Execution item identifier
- Task Description: What to do (static, from Implementation Plan)
- Execution Summary: Narrative of what was done, evidence, observations (editable)
- Task Outcome: Pass or Fail (editable)
- Performed By - Date: Signature (editable)

TASK OUTCOME:
- Pass: Task completed as planned
- Fail: Task could not be completed as planned - attach VAR with explanation

VAR TYPES (see VAR-TEMPLATE):
- Type 1: Use when the failed task is critical to CR objectives
- Type 2: Use when impact is contained and CR can conceptually close

EXECUTION SUMMARY EXAMPLES:
- "Implemented per plan. Commit abc123."
- "Modified src/module.py:45-67. Unit tests passing."
- "Created SOP-007 (now EFFECTIVE)."
-->

| EI | Task Description | Execution Summary | Task Outcome | Performed By - Date |
|----|------------------|-------------------|--------------|---------------------|
| EI-1 | Diagnose scrollback failure: launch GUI, reproduce issue, identify root cause | Three-layer root cause identified: (1) Claude Code enables mouse tracking (ESC[?1000h/1006h), causing xterm.js to forward wheel events to app instead of scrolling buffer; (2) tmux sends alternate screen (ESC[?1049h) which has zero scrollback in xterm.js; (3) Claude Code's Ink-based differential renderer clears scrollback via ESC[3J on every render cycle. Diagnosed via research agents examining Claude Code source, PTY buffer pipeline, and xterm.js scrollback mechanics. | Pass | claude - 2026-02-14 |
| EI-2 | Implement fix based on diagnosis | Added `stripTerminalModes()` in `useHubConnection.ts` that filters PTY output before xterm.js write. Strips: mouse tracking DECSET/DECRST (modes 1000,1002,1003,1005,1006,1015), alternate screen (modes 47,1047,1049), scrollback clear (ESC[3J), and full reset (ESC c). Applied to both initial buffer replay (`subscribed`) and ongoing output. Also filters DA response sequences from input. Commits: 1220914, a6b480a, 91355af, 807a69a, debb48f. | Pass | claude - 2026-02-14 |
| EI-3 | Verify scrollback, resize, tab switching, and input handling | Lead verified full scrollback works — can scroll through entire chat history. Temporary buffer diagnostics confirmed: baseY grows 0 to 105 (scrollback accumulating), buffer type=normal (alt screen stripped successfully). Terminal resize, tab switching, and input handling unaffected. Debug logging removed in commit debb48f. | Pass | claude - 2026-02-14 |

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

Add rows as needed. When adding rows, fill columns 3-5 during execution.
-->

---

### Execution Comments

| Comment | Performed By - Date |
|---------|---------------------|
| Scrollback issue had three independent blockers that all needed simultaneous resolution. Iterative diagnosis across 5 commits, narrowing from wheel event handling to escape sequence filtering. Final working solution is a 10-line filter function. | claude - 2026-02-14 |
| Observed separate issue: tmux initial terminal dimensions default to 80x24 causing TUI table formatting misalignment. Logged as backlog item — not in CR-080 scope. | claude - 2026-02-14 |

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

Record observations, decisions, or issues encountered during execution.
Add rows as needed.

This section is the appropriate place to attach VARs that do not apply
to any individual execution item, but apply to the CR as a whole.
-->

---

## 11. Execution Summary

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

Complete this section after all EIs are executed.
Summarize the overall outcome and any deviations from the plan.
-->

All three execution items passed. Terminal scrollback in the Agent Hub GUI is fully functional. The fix strips four categories of escape sequences from PTY output before writing to xterm.js: mouse tracking modes, alternate screen modes, scrollback-clearing (ESC[3J), and full reset (ESC c). The `scrollback: 10000` buffer configured in xterm.js now accumulates content correctly, and users can scroll through complete agent conversation history using the mouse wheel. No regressions observed in terminal resize, tab switching, or input handling.

---

## 12. References

- **SOP-001:** Document Control
- **SOP-002:** Change Control
- **SOP-004:** Document Execution

---

**END OF DOCUMENT**
