---
title: Fix Template Loading to Include revision_summary Field
revision_summary: 'INV-004-CAPA-001: Fix missing revision_summary in template loading'
---

# CR-021: Fix Template Loading to Include revision_summary Field

## 1. Purpose

Fix the `load_template_for_type()` function to include `revision_summary: 'Initial draft'` in the frontmatter of newly created documents. This addresses INV-004-CAPA-001.

---

## 2. Scope

### 2.1 Context

INV-004 identified that CR-019's implementation of template loading produces documents with incomplete frontmatter: the `revision_summary` field is missing.

- **Parent Document:** INV-004 (CAPA-001)

### 2.2 Changes Summary

Modify `load_template_for_type()` to always include `revision_summary: 'Initial draft'` in the frontmatter dictionary.

### 2.3 Files Affected

- `.claude/qms.py` - Modify `load_template_for_type()` function (lines 819-827)

---

## 3. Current State

The `load_template_for_type()` function contains logic that explicitly skips `revision_summary`:
```python
frontmatter = {
    "title": title,
}
# Keep revision_summary if it's meaningful, otherwise skip
if example_fm.get("revision_summary") and example_fm["revision_summary"] != "Initial draft":
    frontmatter["revision_summary"] = example_fm["revision_summary"]
```

This produces documents with only a `title` field in frontmatter.

---

## 4. Proposed State

The `load_template_for_type()` function always includes `revision_summary`:
```python
frontmatter = {
    "title": title,
    "revision_summary": "Initial draft",
}
```

All newly created documents have complete frontmatter with both `title` and `revision_summary` fields.

---

## 5. Change Description

### 5.1 Code Change

Remove the conditional logic and always include `revision_summary: 'Initial draft'` in the frontmatter dictionary.

**Before (lines 819-825):**
```python
# Update frontmatter with actual title
frontmatter = {
    "title": title,
}
# Keep revision_summary if it's meaningful, otherwise skip
if example_fm.get("revision_summary") and example_fm["revision_summary"] != "Initial draft":
    frontmatter["revision_summary"] = example_fm["revision_summary"]
```

**After:**
```python
# Update frontmatter with actual title and default revision_summary
frontmatter = {
    "title": title,
    "revision_summary": "Initial draft",
}
```

---

## 6. Justification

- **Compliance:** Per SOP-001 Section 5.1, document frontmatter requires both `title` and `revision_summary` fields
- **Root cause fix:** Addresses INV-004 primary root cause (defensive code incorrectly skipping revision_summary)
- **Simplification:** Removes unnecessary conditional logic

---

## 7. Impact Assessment

### 7.1 Files Affected

| File | Change Type | Description |
|------|-------------|-------------|
| `.claude/qms.py` | Modify | Simplify frontmatter construction in `load_template_for_type()` |

### 7.2 Documents Affected

| Document | Change Type | Description |
|----------|-------------|-------------|
| None | N/A | Only affects future document creation |

### 7.3 Other Impacts

None. Existing documents are unaffected.

---

## 8. Testing Summary

- Create a new CR and verify frontmatter contains both `title` and `revision_summary` fields
- Create a new SOP and verify frontmatter contains both fields
- Verify `revision_summary` value is "Initial draft"

---

## 9. Implementation Plan

### 9.1 Code Change

1. Modify `load_template_for_type()` in `.claude/qms.py`
2. Replace conditional revision_summary logic with static inclusion

### 9.2 Verification

1. Create test CR document
2. Verify frontmatter completeness
3. Cancel test document

---

## 10. Execution

| EI | Task Description | Execution Summary | Task Outcome | Performed By - Date |
|----|------------------|-------------------|--------------|---------------------|
| EI-1 | Modify load_template_for_type() to include revision_summary | [SUMMARY] | [Pass/Fail] | [PERFORMER] - [DATE] |
| EI-2 | Test by creating new CR and verifying frontmatter | [SUMMARY] | [Pass/Fail] | [PERFORMER] - [DATE] |

---

### Execution Comments

| Comment | Performed By - Date |
|---------|---------------------|
| [COMMENT] | [PERFORMER] - [DATE] |

---

## 11. Execution Summary

[EXECUTION_SUMMARY]

---

## 12. References

- **SOP-001:** Document Control
- **SOP-002:** Change Control
- **INV-004:** CR-019 Template Loading Missing revision_summary Field (parent investigation)
- **CR-019:** Use QMS TEMPLATE Documents for Document Creation (source of defect)

---

**END OF DOCUMENT**
