---
title: Inbox Watcher Notification Injection Not Implemented
revision_summary: Initial draft
---

# CR-056-VAR-003: Inbox Watcher Notification Injection Not Implemented

## 1. Variance Identification

| Parent Document | Affected Item | VAR Type |
|-----------------|---------------|----------|
| CR-056 | EI-5 (inbox-watcher.py), Section 4 (Proposed State), Section 5.6, T4 | Type 2 |

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

VAR TYPE:
- Type 1: Full closure required to clear block on parent
- Type 2: Pre-approval sufficient to clear block on parent
-->

---

## 2. Detailed Description

CR-056's pre-approved scope describes the inbox watcher as a system that detects new inbox files *and* injects visual notifications into the agent's running container terminal. Specifically:

- **Section 4 (Proposed State):** "Agents see a visual notification prompting them to check their inbox"
- **Section 5.6:** `docker exec -it agent-qa bash -c 'echo "... New task: Review CR-056 ..."'` — notification injected into the agent's container
- **T4:** "verify qa receives inbox notification"

**Expected:** When a task arrives in an agent's inbox, the inbox watcher injects a visual notification into that agent's active Claude Code terminal session.

**Actual:** The inbox watcher (`docker/scripts/inbox-watcher.py`) correctly detects new inbox files via the `watchdog` library and prints notifications — but only to its own dedicated monitoring terminal. It does not inject notifications into the agent's container via `docker exec`. The agent does not see the notification unless the user manually switches to the watcher's terminal window.

The watcher's core file-detection functionality works correctly and was demonstrated during end-to-end testing. The missing piece is the last-mile delivery: getting the notification from the watcher's terminal into the agent's session.

---

## 3. Root Cause

Scope prioritization during CR-056 execution. The primary objective — getting multiple agents running in separate containers with reliable MCP connectivity — consumed the majority of execution effort, particularly after the MCP reliability issue (CR-056-VAR-001) required a 17-phase debugging investigation and the creation of CR-057 (stdio proxy). Notification injection was deprioritized in favor of achieving reliable multi-agent operation. The file-detection half of the watcher was implemented; the injection half was not.

---

## 4. Variance Type

Scope Error — The pre-approved scope included notification injection as part of the inbox watcher deliverable (EI-5, Section 5.6). The implementation delivered file detection but not injection. This is incomplete delivery against the approved scope.

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

Select one:
- Execution Error: Executor made a mistake or didn't follow instructions
- Scope Error: Plan/scope was written or designed incorrectly
- System Error: The system behaved unexpectedly
- Documentation Error: Error in a document other than the parent
- External Factor: Environmental or external issue
- Other: See Detailed Description
-->

---

## 5. Impact Assessment

**Effect on parent objectives:** Low. CR-056's core objective — "Enable multiple QMS agents to run simultaneously in separate containers" — is fully met. Agents can run, connect to MCP, self-identify correctly, and perform QMS workflows. The inbox watcher detects new tasks correctly; the user simply has to check the watcher's terminal rather than seeing the notification appear in the agent's terminal.

**What works:**
- File detection via watchdog (functional, tested)
- Notification formatting (ASCII-art notifications generated correctly)
- Multi-agent awareness (monitors all specified agents' inboxes)

**What is missing:**
- `docker exec` injection into agent containers (Section 5.6)
- Agent-visible notification in their own terminal (Section 4, T4)

**Why Type 2 is appropriate:** The missing functionality is a convenience improvement, not a blocking gap. The multi-agent workflow is fully operational — agents can be notified by the user checking the watcher terminal. The core infrastructure that CR-056 was designed to deliver is complete and proven. Holding CR-056 open while the injection feature is developed would be disproportionate to the gap.

---

## 6. Proposed Resolution

Create a new Change Record to complete the inbox watcher's notification injection capability, absorbing all remaining work from CR-056's pre-approved scope related to Sections 4, 5.6, and T4.

The new CR should:
1. Implement `docker exec` notification injection from the watcher into agent containers
2. Handle the case where the agent's Claude Code session is actively processing (notification must not corrupt stdin/stdout)
3. Test end-to-end: route a document, verify the agent sees the notification in their own terminal without switching windows

This VAR is Type 2: pre-approval is sufficient to unblock CR-056 closure. The follow-up CR provides a dedicated container for the remaining work without keeping CR-056 open indefinitely.

---

## 7. Resolution Work

<!--
NOTE: Do NOT delete this comment block. It provides guidance for execution.

If the resolution work encounters issues, create a nested VAR.
-->

### Resolution: CR-056

| EI | Task Description | Execution Summary | Task Outcome | Performed By - Date |
|----|------------------|-------------------|--------------|---------------------|
| EI-1 | Create CR for inbox watcher notification injection | CR-058 (Inbox Watcher Notification Injection via tmux) created, executed, and CLOSED. Implements tmux send-keys injection from the inbox watcher into agent Claude Code sessions. All 5 EIs passed, end-to-end testing confirmed idle wake-up and active-agent queuing. Commit `fd05d8e`. | Pass | claude - 2026-02-06 |

---

### Resolution Comments

| Comment | Performed By - Date |
|---------|---------------------|
| CR-058 used tmux send-keys rather than the `docker exec bash -c 'echo ...'` approach originally described in CR-056 Section 5.6. tmux provides push-based injection that works with Claude Code's input prompt and native pending message queue, which is more robust than echo-based injection. | claude - 2026-02-06 |

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

Record observations, decisions, or issues encountered during resolution.
Add rows as needed.

This section is the appropriate place to attach nested VARs that do not
apply to any individual resolution item, but apply to the resolution as a whole.
-->

---

## 8. VAR Closure

| Details of Resolution | Outcome | Performed By - Date |
|-----------------------|---------|---------------------|
| CR-058 fully addresses the variance. The inbox watcher now injects notifications directly into agent tmux sessions via `docker exec` + `tmux send-keys`. Agents receive task notifications at their Claude Code prompt (idle) or in their pending message queue (active). All original scope items from CR-056 Sections 4, 5.6, and T4 are resolved. | Pass | claude - 2026-02-06 |

---

## 9. References

- **SOP-004:** Document Execution
- **CR-056:** Multi-Agent Container Session Infrastructure (parent)
- **CR-056 Section 4:** Proposed State — "Agents see a visual notification prompting them to check their inbox"
- **CR-056 Section 5.6:** inbox-watcher.py design — `docker exec` notification injection
- **CR-056 T4:** "verify qa receives inbox notification"
- **CR-056-VAR-001:** MCP reliability variance (consumed execution bandwidth that deprioritized this feature)
- **CR-057:** MCP Stdio Proxy (CLOSED; corrective action from VAR-001)

---

**END OF VARIANCE REPORT**
