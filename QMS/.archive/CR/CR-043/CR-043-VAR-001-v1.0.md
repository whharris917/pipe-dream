---
title: Add Claude Code Authentication and Python Dev Environment Support
revision_summary: Initial draft
---

# CR-043-VAR-001: Add Claude Code Authentication and Python Dev Environment Support

## 1. Variance Identification

| Parent Document | Failed Item | VAR Type |
|-----------------|-------------|----------|
| CR-043 | Scope Definition (Sections 2, 5) | Type 1 |

---

## 2. Detailed Description

During pre-execution review of CR-043, two critical gaps were identified in the container infrastructure design:

1. **Claude Code Authentication**: The container has no mechanism to authenticate with Anthropic's API. Claude Code stores credentials in `~/.claude/.credentials.json` on the host, but this file is not mounted into the container. Without authentication, Claude Code cannot function.

2. **Python Development Environment**: The container is intended to support code development and testing, but lacks:
   - The `python3-venv` package for creating virtual environments
   - Documentation of the workflow for setting up dev environments in `/projects/`

**Expected:** Container can run Claude Code with proper authentication and support Python development workflows.

**Actual:** Original scope omitted credentials mount and Python venv tooling.

---

## 3. Root Cause

The original CR scope focused on QMS isolation and MCP connectivity but did not account for:
- Claude Code's authentication requirements (credentials file location)
- The practical needs of Python development within the container

These requirements were identified during architectural discussion after pre-approval but before execution began.

---

## 4. Variance Type

Scope Error: Plan/scope was written or designed incorrectly

---

## 5. Impact Assessment

**Impact on CR-043 Objectives:**
- Without credentials mount: Claude Code cannot authenticate, rendering the container non-functional for its intended purpose
- Without Python venv support: Container cannot support code development and testing workflows

**Severity:** Critical - affects core functionality

**Scope of Change:**
- Dockerfile: Add `python3-venv` package
- docker-compose.yml: Add credentials volume mount
- Filesystem structure: Document credentials and venv locations
- Testing: Add verification of authentication and venv creation
- EI table: Add two new execution items

---

## 6. Proposed Resolution

Expand CR-043 scope to include:

1. **Credentials Mount** (docker-compose.yml):
   ```yaml
   - ~/.claude/.credentials.json:/.claude/.credentials.json:ro
   ```

2. **Python venv Support** (Dockerfile):
   ```dockerfile
   RUN apt-get update && apt-get install -y \
       ... \
       python3-venv \
       && rm -rf /var/lib/apt/lists/*
   ```

3. **Updated Filesystem Structure:**
   ```
   /.claude/
   │   └── .credentials.json    # Auth credentials (mounted at runtime)
   /projects/
   │   └── {repo}/
   │       └── .venv/           # Virtual environment for dev/test
   ```

4. **Additional Tests:**
   - Verify credentials mount enables Claude Code authentication
   - Verify container can create venv and pip install in /projects/

5. **Additional EIs:**
   - EI-11: Test Claude Code authentication via mounted credentials
   - EI-12: Test Python venv creation and pip install in /projects/
   - Renumber existing EI-11/12 to EI-13/14

---

## 7. Resolution Work

### Resolution: CR-043

| EI | Task Description | Execution Summary | Task Outcome | Performed By - Date |
|----|------------------|-------------------|--------------|---------------------|
| VAR-EI-1 | Update Dockerfile to add python3-venv | python3-venv added to apt-get install in Dockerfile during CR-043 EI-2 | Pass | claude - 2026-02-01 |
| VAR-EI-2 | Update docker-compose.yml to mount credentials | Credentials mount (`~/.claude/.credentials.json:/.claude/.credentials.json:ro`) added during CR-043 EI-4 | Pass | claude - 2026-02-01 |
| VAR-EI-3 | Update filesystem structure documentation | docker/README.md includes credentials and venv documentation | Pass | claude - 2026-02-01 |
| VAR-EI-4 | Update access control table | docker/README.md access control table updated; CLAUDE.md container section includes credentials path | Pass | claude - 2026-02-01 |
| VAR-EI-5 | Add EI-11 and EI-12 to CR-043 execution table | Not applicable - auth/venv tests executed as VAR-EI-6/7; original CR-043 EI-11/12 unchanged | N/A | claude - 2026-02-01 |
| VAR-EI-6 | Test credentials mount and Claude Code auth | Verified: `/.claude/.credentials.json` mounted (451 bytes), Claude CLI available in container | Pass | claude - 2026-02-01 |
| VAR-EI-7 | Test Python venv creation in /projects/ | Verified: `python3 -m venv /projects/test-venv` creates venv with bin, lib, include dirs | Pass | claude - 2026-02-01 |

---

### Resolution Comments

| Comment | Performed By - Date |
|---------|---------------------|
| VAR scope was incorporated during CR-043 file creation rather than as post-hoc modifications. This was more efficient and avoided creating files that would immediately need patching. | claude - 2026-02-01 |
| VAR-EI-5 marked N/A because the original plan to add auth/venv tests as new CR-043 EIs was superseded by testing them directly within the VAR execution (VAR-EI-6, VAR-EI-7). | claude - 2026-02-01 |

---

## 8. VAR Closure

| Details of Resolution | Outcome | Performed By - Date |
|-----------------------|---------|---------------------|
| All VAR scope items successfully incorporated into CR-043 deliverables. Credentials mount enables Claude Code authentication in container. python3-venv enables Python development workflows in /projects/. Both features tested and verified. | Pass | claude - 2026-02-01 |

---

## 9. References

- **SOP-004:** Document Execution
- **CR-043:** Implement Containerized Claude Agent Infrastructure
- **Session-2026-02-01-001:** Container Architecture Vision document

---

**END OF VARIANCE REPORT**
