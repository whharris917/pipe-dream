---
title: Project State Preservation, Rollback Procedures, and CR-085 Language Correction
revision_summary: Initial draft
---

# CR-086: Project State Preservation, Rollback Procedures, and CR-085 Language Correction

## 1. Purpose

This CR corrects language introduced by CR-085, adds post-execution state capture, and adds rollback procedures for code CRs. CR-085 used "QMS repository" when the correct scope is "project repository and all submodules." Additionally, the pre-execution commit is repositioned from a pre-release prerequisite to the first execution item, and a post-execution commit is added as the final execution item. Finally, SOP-005 gains rollback procedures for code changes — the last remaining gap from the SOP-005 qualification process improvement.

---

## 2. Scope

### 2.1 Context

Independent improvement identified during review of CR-085 language and completion of the SOP-005 qualification process documentation.

- **Parent Document:** None

### 2.2 Changes Summary

Three related concerns bundled into one CR:

1. **Fix CR-085 language** — "QMS repository" replaced with "project repository and all submodules" across SOP-004, SOP-002, and TEMPLATE-CR
2. **Reposition pre-execution commit and add post-execution commit** — The pre-execution commit becomes the first execution item (EI-1) of every CR, and the post-execution commit becomes the final execution item. Both commit hashes are recorded in the EI table as execution evidence.
3. **Add rollback procedures** — SOP-005 gains a new Section 7.1.5 covering execution branch and main branch rollback scenarios

### 2.3 Files Affected

- `QMS/SOP/SOP-004.md` — Section 5: fix language, reposition pre-execution commit, add post-execution commit
- `QMS/SOP/SOP-002.md` — Section 7.2: fix language, restructure steps; Section 10: add SOP-005 cross-reference
- `QMS/TEMPLATE/TEMPLATE-CR.md` — Section 10 comment block: fix language, add post-execution guidance
- `QMS/SOP/SOP-005.md` — New Section 7.1.5: rollback procedures
- `qms-cli/seed/templates/TEMPLATE-CR.md` — Align seed copy with TEMPLATE-CR after it reaches EFFECTIVE

---

## 3. Current State

SOP-004 Section 5 and SOP-002 Section 7.2 refer to committing the "QMS repository" before releasing a CR for execution. This is inaccurate — the project repository (pipe-dream) contains the QMS, Flow State, and QMS CLI submodules, and all of it needs to be committed.

The pre-execution commit is currently a pre-release prerequisite (happens before `qms release`). There is no post-execution commit convention. Commit hashes for the pre and post states are not systematically recorded as execution evidence.

SOP-005 has no rollback procedures. When a code change needs to be undone — whether on an execution branch or after merge to main — there is no documented approach.

TEMPLATE-CR's execution instructions reference "QMS repository" and have no post-execution commit guidance.

---

## 4. Proposed State

SOP-004 Section 5, SOP-002 Section 7.2, and TEMPLATE-CR all reference "project repository and all submodules."

The pre-execution commit is the first execution item (EI-1) of every CR. The post-execution commit is the final execution item. Both commit hashes are recorded in the EI table, providing bookend evidence of the repository state before and after execution.

SOP-005 Section 7.1.5 documents rollback procedures for execution branch rollback (before merge) and main branch rollback (after merge). `git revert` is mandated; `git reset` is prohibited because it does not preserve history.

TEMPLATE-CR's execution instructions reflect the updated language and include both pre-execution and post-execution commit guidance.

The seed copy of TEMPLATE-CR in qms-cli is aligned.

---

## 5. Change Description

### 5.1 SOP-004 Section 5

Replace the single paragraph introduced by CR-085 with two paragraphs:

- **Paragraph 1 (pre-execution):** Change "QMS repository" to "project repository and all submodules." Reposition from a pre-release prerequisite to a first-execution-item convention: "After releasing an executable document for execution, the initiator shall commit and push the project repository and all submodules as the first execution item." The commit hash is recorded in EI-1's execution summary.
- **Paragraph 2 (post-execution):** New. The initiator shall commit and push the project repository and all submodules as the final execution item, before routing for post-review. The commit hash is recorded in the final EI's execution summary.

### 5.2 SOP-002 Section 7.2

Restructure the execution steps from 5 to 7:

1. Releases the CR for execution (`qms release`)
2. Commits and pushes the project repository and all submodules to capture the pre-execution state (first execution item, per SOP-004 Section 5)
3. Implements the change as documented
4. Performs testing as described in the CR
5. Documents results in the CR
6. Commits and pushes the project repository and all submodules to capture the post-execution state (final execution item, per SOP-004 Section 5)
7. Routes the CR for post-review

### 5.3 SOP-002 Section 10

Add a cross-reference after the existing rollback list:

> For CRs affecting SDLC-governed code, see SOP-005 Section 7.1.5 for specific rollback procedures covering execution branch and main branch scenarios.

### 5.4 TEMPLATE-CR Section 10 Comment Block

Replace the PRE-EXECUTION note with updated language and add POST-EXECUTION note:

- PRE-EXECUTION note: References "project repository (including all submodules)" and instructs recording the commit hash in EI-1's execution summary
- POST-EXECUTION note: Instructs committing and pushing as the final EI, recording the commit hash in the final EI's execution summary

### 5.5 SOP-005 New Section 7.1.5: Rollback Procedures

Insert after Section 7.1.4 (Why Merge Type Matters), before Section 7.2 (Genesis Sandbox):

**Execution branch rollback (before merge to main):**
1. Revert or fix commits on the execution branch
2. Re-run tests, verify CI passes
3. Update the qualified commit hash in the RTM if it changed
4. Document the rollback in the CR execution record

**Main branch rollback (after merge):**
1. Create a new CR documenting the rollback (per SOP-002 Section 10)
2. Use `git revert` on the merge commit to undo the change on main
3. Verify all tests pass on the reverted state
4. Update SDLC documents (RS/RTM) to reflect the reverted state
5. The original CR remains closed — the rollback CR provides the audit trail

`git revert` is the only acceptable approach. `git reset` is prohibited because it does not preserve history. The original commits must remain reachable for audit purposes.

### 5.6 Seed Alignment

After TEMPLATE-CR reaches EFFECTIVE, copy its content to `qms-cli/seed/templates/TEMPLATE-CR.md` to keep the seed in sync.

---

## 6. Justification

- **Language accuracy:** "QMS repository" is misleading. The project repository contains the QMS *and* code submodules. All must be committed to capture the full project state.
- **Evidence traceability:** Making the pre and post commits actual execution items means their commit hashes are recorded as formal evidence in the EI table, not just informal convention.
- **Rollback gap:** SOP-005 documents the full execution branch workflow (branching, testing, merge gate, merge type) but has no guidance for what to do when a change needs to be undone. This is the last remaining gap in the qualification process documentation.
- **History preservation:** Mandating `git revert` over `git reset` ensures the audit trail is never destroyed. An auditor can always trace what happened and why.

---

## 7. Impact Assessment

### 7.1 Files Affected

| File | Change Type | Description |
|------|-------------|-------------|
| `QMS/SOP/SOP-004.md` | Modify | Section 5: fix language, reposition pre-execution, add post-execution |
| `QMS/SOP/SOP-002.md` | Modify | Section 7.2: restructure steps; Section 10: add cross-reference |
| `QMS/TEMPLATE/TEMPLATE-CR.md` | Modify | Section 10 comment: fix language, add post-execution guidance |
| `QMS/SOP/SOP-005.md` | Modify | Add Section 7.1.5: rollback procedures |
| `qms-cli/seed/templates/TEMPLATE-CR.md` | Modify | Align seed copy with TEMPLATE-CR |

### 7.2 Documents Affected

| Document | Change Type | Description |
|----------|-------------|-------------|
| SOP-004 | Modify | Section 5 rewrite |
| SOP-002 | Modify | Section 7.2 restructure, Section 10 addition |
| TEMPLATE-CR | Modify | Execution instructions comment block |
| SOP-005 | Modify | New Section 7.1.5 |

### 7.3 Other Impacts

None. All changes are document-only. No code, no external systems affected.

---

## 8. Testing Summary

<!--
NOTE: Do NOT delete this comment. It provides guidance during document authoring.

For code CRs, address both categories per SOP-002 Section 6.8:
1. Automated verification: unit tests, qualification tests, CI
2. Integration verification: what will be exercised through user-facing levers
   in a running system to demonstrate the change is effective

For document-only CRs, a description of procedural verification is sufficient.
Delete the subsections below and use a simple list.
-->

Document-only CR. Verification:

- SOP-004 Section 5 says "project repository and all submodules" (not "QMS repository"), describes first-EI and final-EI convention
- SOP-002 Section 7.2 has 7 steps with release first, pre-execution commit second, post-execution commit sixth
- SOP-002 Section 10 contains cross-reference to SOP-005 Section 7.1.5
- TEMPLATE-CR has PRE-EXECUTION and POST-EXECUTION notes with correct language and commit hash guidance
- SOP-005 Section 7.1.5 exists between 7.1.4 and 7.2, covers execution branch and main branch rollback, mandates `git revert` and prohibits `git reset`
- Seed copy matches TEMPLATE-CR

---

## 9. Implementation Plan

Each document update follows the checkout-edit-checkin-review-approval cycle. The EI table mirrors that sequence, with bookend commits as EI-1 and EI-7.

1. EI-1: Commit and push project repository (pre-execution baseline)
2. EI-2: Update SOP-004 Section 5
3. EI-3: Update SOP-002 Section 7.2 and Section 10
4. EI-4: Update TEMPLATE-CR Section 10 comment block
5. EI-5: Update SOP-005 (add Section 7.1.5)
6. EI-6: Align seed copy in qms-cli
7. EI-7: Commit and push project repository (post-execution state)

---

## 10. Execution

<!--
EXECUTION PHASE INSTRUCTIONS
============================
NOTE: Do NOT delete this comment block. It provides guidance for execution.

PRE-EXECUTION: After releasing for execution, the first execution item is to
commit and push the project repository (including all submodules) to capture
the pre-execution baseline (per SOP-004 Section 5). Record the commit hash
in EI-1's execution summary.

POST-EXECUTION: The final execution item is to commit and push the project
repository (including all submodules) to capture the post-execution state
(per SOP-004 Section 5). Record the commit hash in the final EI's execution
summary.

- Sections 1-9 are PRE-APPROVED content - do NOT modify during execution
- Only THIS TABLE and the comment sections below should be edited during execution phase

COLUMNS:
- EI: Execution item identifier
- Task Description: What to do (static, from Implementation Plan)
- Execution Summary: Narrative of what was done, evidence, observations (editable)
- Task Outcome: Pass or Fail (editable)
- Performed By - Date: Signature (editable)

TASK OUTCOME:
- Pass: Task completed as planned
- Fail: Task could not be completed as planned - attach VAR with explanation

VAR TYPES (see VAR-TEMPLATE):
- Type 1: Use when the failed task is critical to CR objectives
- Type 2: Use when impact is contained and CR can conceptually close

EXECUTION SUMMARY EXAMPLES:
- "Implemented per plan. Commit abc123."
- "Modified src/module.py:45-67. Unit tests passing."
- "Created SOP-007 (now EFFECTIVE)."
-->

| EI | Task Description | Execution Summary | Task Outcome | Performed By - Date |
|----|------------------|-------------------|--------------|---------------------|
| EI-1 | Commit and push project repository to capture pre-execution baseline | Committed and pushed. Commit c481458. | Pass | claude - 2026-02-15 |
| EI-2 | Update SOP-004 Section 5: fix language, reposition pre-execution commit as first EI, add post-execution commit as final EI | Updated Section 5: replaced "QMS repository" with "project repository and all submodules," repositioned pre-execution commit from pre-release prerequisite to first-EI convention, added post-execution commit as final-EI convention. SOP-004 now EFFECTIVE v7.0. | Pass | claude - 2026-02-15 |
| EI-3 | Update SOP-002 Section 7.2 (restructure to 7 steps) and Section 10 (add SOP-005 cross-reference for code rollback) | Restructured Section 7.2 from 5 steps to 7 steps: release first, pre-execution commit as step 2, post-execution commit as step 6, post-review routing as step 7. Added SOP-005 Section 7.1.5 cross-reference to Section 10. SOP-002 now EFFECTIVE v12.0. | Pass | claude - 2026-02-15 |
| EI-4 | Update TEMPLATE-CR Section 10 comment block: fix PRE-EXECUTION language, add POST-EXECUTION note | Updated PRE-EXECUTION note to reference "project repository (including all submodules)" and first-EI convention. Added POST-EXECUTION note with final-EI convention and commit hash guidance. TEMPLATE-CR now EFFECTIVE v7.0. | Pass | claude - 2026-02-15 |
| EI-5 | Add SOP-005 Section 7.1.5: rollback procedures for execution branch and main branch scenarios | Added Section 7.1.5 between 7.1.4 and 7.2. Covers execution branch rollback (revert/fix, re-test, update RTM) and main branch rollback (new CR, git revert on merge commit, update SDLC docs). Mandates git revert, prohibits git reset. SOP-005 now EFFECTIVE v5.0. | Pass | claude - 2026-02-15 |
| EI-6 | Align seed copy in qms-cli/seed/templates/TEMPLATE-CR.md with TEMPLATE-CR | Updated seed frontmatter revision_summary and execution instructions comment block to match EFFECTIVE TEMPLATE-CR v7.0. | Pass | claude - 2026-02-15 |
| EI-7 | Commit and push project repository to capture post-execution state | [SUMMARY] | [Pass/Fail] | [PERFORMER] - [DATE] |

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

Add rows as needed. When adding rows, fill columns 3-5 during execution.
-->

---

### Execution Comments

| Comment | Performed By - Date |
|---------|---------------------|
| [COMMENT] | [PERFORMER] - [DATE] |

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

Record observations, decisions, or issues encountered during execution.
Add rows as needed.

This section is the appropriate place to attach VARs that do not apply
to any individual execution item, but apply to the CR as a whole.
-->

---

## 11. Execution Summary

<!--
NOTE: Do NOT delete this comment. It provides guidance during document execution.

Complete this section after all EIs are executed.
Summarize the overall outcome and any deviations from the plan.
-->

[EXECUTION_SUMMARY]

---

## 12. References

- **SOP-001:** Document Control
- **SOP-002:** Change Control
- **SOP-004:** Document Execution
- **SOP-005:** Code Governance
- **CR-085:** Pre-Execution Repository Commit (corrected by this CR)

---

**END OF DOCUMENT**
