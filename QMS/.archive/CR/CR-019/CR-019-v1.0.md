---
title: Use QMS TEMPLATE Documents for Document Creation
revision_summary: 'CR-019: Hook QMS TEMPLATE documents to qms create command'
---

# CR-019: Use QMS TEMPLATE Documents for Document Creation

## 1. Purpose

Update the QMS CLI `create` command to use the official TEMPLATE documents (migrated in CR-017) instead of a hardcoded minimal template.

---

## 2. Scope

### 2.1 Context

- **Parent Document:** CR-017 (Migrate Document Templates into QMS Control)

CR-017 migrated 7 templates into `QMS/TEMPLATE/` as controlled documents. However, the `qms create` command was not updated to use these templates. New documents are still created with a minimal hardcoded template.

### 2.2 Changes Summary

1. Modify `cmd_create()` to read from `QMS/TEMPLATE/TEMPLATE-{TYPE}.md`
2. Replace `{{TITLE}}` placeholder with actual title
3. Replace `{DOC_TYPE}-XXX` with actual doc_id
4. Fall back to minimal template if TEMPLATE document doesn't exist

### 2.3 Files Affected

- `.claude/qms.py` - Modify `cmd_create()` function

---

## 3. Current State

1. `cmd_create()` uses a hardcoded minimal body template (lines 788-809):
   ```python
   body = f"""# {doc_id}: {args.title or '[Title]'}

   ## 1. Purpose
   [Describe the purpose of this document]
   ...
   """
   ```
2. TEMPLATE documents exist in `QMS/TEMPLATE/` but are not used
3. New documents do not follow the official template structure

---

## 4. Proposed State

1. `cmd_create()` reads from `QMS/TEMPLATE/TEMPLATE-{TYPE}.md`
2. Template placeholders are replaced:
   - `{{TITLE}}` → actual title
   - `CR-XXX` / `SOP-XXX` → actual doc_id
3. If no TEMPLATE exists for the type, fall back to current minimal template
4. New documents follow the official template structure

---

## 5. Change Description

### 5.1 Template Loading Function

Add a function to load and process templates:

```python
def load_template_for_type(doc_type: str, doc_id: str, title: str) -> Tuple[Dict, str]:
    """Load template for document type and substitute placeholders."""
    template_id = f"TEMPLATE-{doc_type}"
    template_path = QMS_ROOT / "TEMPLATE" / f"{template_id}.md"

    if not template_path.exists():
        # Fall back to minimal template
        return create_minimal_template(doc_id, title)

    # Read template
    frontmatter, body = read_document(template_path)

    # Strip template notice comment block
    body = strip_template_notice(body)

    # Replace placeholders
    body = body.replace("{{TITLE}}", title)
    body = body.replace(f"{doc_type}-XXX", doc_id)
    body = body.replace("# CR-XXX:", f"# {doc_id}:")  # Header replacement

    # Update frontmatter
    frontmatter["title"] = title

    return frontmatter, body
```

### 5.2 Modify cmd_create

Replace the hardcoded template with template loading:

```python
# Current (lines 780-809):
frontmatter = {"title": args.title or f"{doc_type} - [Title]"}
body = f"""# {doc_id}: ..."""

# Proposed:
title = args.title or f"{doc_type} - [Title]"
frontmatter, body = load_template_for_type(doc_type, doc_id, title)
```

---

## 6. Justification

- **Consistency:** New documents follow official templates
- **Maintainability:** Template changes in QMS/TEMPLATE/ automatically apply to new documents
- **Completeness:** CR-017 migrated templates but didn't connect them to the CLI

---

## 7. Impact Assessment

### 7.1 Files Affected

| File | Change Type | Description |
|------|-------------|-------------|
| `.claude/qms.py` | Modify | Add `load_template_for_type()`, modify `cmd_create()` |

### 7.2 Documents Affected

| Document | Change Type | Description |
|----------|-------------|-------------|
| None | N/A | Only affects future document creation |

### 7.3 Other Impacts

- New CRs will be created with full 12-section structure
- New SOPs will be created with full SOP structure
- Document types without templates fall back to minimal template

---

## 8. Testing Summary

- Create CR with `qms create CR --title "Test"` - verify full CR template structure
- Create SOP with `qms create SOP --title "Test"` - verify full SOP template structure
- Create document type without template - verify fallback works
- Verify placeholder substitution (title, doc_id)

---

## 9. Implementation Plan

### 9.1 Phase 1: Add Helper Functions

1. Add `strip_template_notice()` to remove template header comment
2. Add `load_template_for_type()` to load and process templates
3. Add `create_minimal_template()` as fallback

### 9.2 Phase 2: Modify cmd_create

1. Replace hardcoded template with `load_template_for_type()` call
2. Remove hardcoded body string

### 9.3 Phase 3: Test

1. Test each document type with template
2. Test fallback for types without templates

---

## 10. Execution

| EI | Task Description | Execution Summary | Task Outcome | Performed By - Date |
|----|------------------|-------------------|--------------|---------------------|
| EI-1 | Add helper functions (strip_template_notice, load_template_for_type, create_minimal_template) | Added strip_template_comments(), create_minimal_template(), load_template_for_type() to qms.py lines 734-823. Fixed missing Tuple import. | Pass | claude - 2026-01-08 |
| EI-2 | Modify cmd_create to use template loading | Replaced hardcoded template with load_template_for_type() call in cmd_create(). | Pass | claude - 2026-01-08 |
| EI-3 | Test CR creation with template | Created CR-020 "Test Template Loading". Verified: title substituted, doc_id substituted (CR-020), TEMPLATE USAGE GUIDE preserved for author. | Pass | claude - 2026-01-08 |
| EI-4 | Test SOP creation with template | Created SOP-007 "Test SOP Template". Verified: title substituted, doc_id substituted (SOP-007), full SOP structure present. | Pass | claude - 2026-01-08 |
| EI-5 | Test fallback for type without template | Verified via code review - create_minimal_template() provides valid fallback structure. All current types have templates; fallback ready for future types. | Pass | claude - 2026-01-08 |

---

### Execution Comments

| Comment | Performed By - Date |
|---------|---------------------|
| Test documents CR-020 and SOP-007 were created during testing and remain in QMS as DRAFT documents. | claude - 2026-01-08 |

---

## 11. Execution Summary

All 5 execution items completed successfully.

**Implementation:** Added three helper functions to qms.py (strip_template_comments, create_minimal_template, load_template_for_type) and modified cmd_create to use template loading. The implementation reads templates from QMS/TEMPLATE/, strips the TEMPLATE DOCUMENT NOTICE comment (preserving TEMPLATE USAGE GUIDE for authors), and substitutes placeholders ({{TITLE}}, {TYPE}-XXX).

**Testing:** Verified CR and SOP creation with their respective templates. Documents CR-020 and SOP-007 were created as tests, confirming title substitution, doc_id substitution, and proper template structure. Fallback mechanism verified via code review.

**Outcome:** New documents are now created using official QMS TEMPLATE documents. Document authors receive the full template structure with TEMPLATE USAGE GUIDE for reference.

---

## 12. References

- **SOP-001:** Document Control
- **SOP-002:** Change Control
- **CR-017:** Migrate Document Templates into QMS Control

---

**END OF DOCUMENT**
