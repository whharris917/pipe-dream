---
title: Documentation fixes, QA permissions, and archive bug
revision_summary: Initial draft
---

# CR-005: Documentation fixes, QA permissions, and archive bug

## 1. Purpose

Correct cross-reference errors and minor inconsistencies identified during an ad-hoc consistency review. Also:
- Update the CR template to comply with SOP-001 Section 5.4 (no manual metadata in document bodies)
- Grant QA route permission to enable fast-track approval when no additional reviewers are needed
- Fix bug where effective versions (vN.0) are not archived on checkout

## 2. Scope

This change affects:

- **qa.md** - Fix incorrect section reference
- **CLAUDE.md** - Fix misleading cross-reference
- **bu.md** - Align effective date with other agents
- **SOP-002** - Clarify CR ID reuse policy
- **CR template** - Remove manual metadata fields and revision history table
- **SOP-001** - Grant QA route permission
- **qms.py** - Allow qa user to execute route command; archive effective version on checkout

## 3. Changes

### 3.1 qa.md - Wrong Section Reference

**Current (line 56):**
```
- [ ] Frontmatter is complete and accurate per SOP-001 Section 12
```

**Proposed:**
```
- [ ] Frontmatter is complete and accurate per SOP-001 Section 5.1
```

**Rationale:** Section 12 is "User Workspaces and Inboxes". Frontmatter requirements are in Section 5.1 (Document Frontmatter).

### 3.2 CLAUDE.md - Misleading Cross-Reference

**Current (line 142):**
```
See **SOP-002** for the complete specification.
```

**Proposed:** Remove this sentence.

**Rationale:** SOP-002 is Change Control, not the Air Gap specification. The Air Gap is fully documented in CLAUDE.md Section 3 itself.

### 3.3 bu.md - Effective Date Inconsistency

**Current (line 94):**
```
*Effective Date: 2026-01-01*
```

**Proposed:**
```
*Effective Date: 2026-01-02*
```

**Rationale:** All other agent definition files (qa.md, tu_ui.md, tu_scene.md, tu_sketch.md, tu_sim.md) use 2026-01-02.

### 3.4 SOP-002 - CR ID Reuse Policy

**Current (Section 5):**
> Numbers are assigned in order of creation and are never reused.

**Conflict with SOP-001 Section 9.7.1:**
> Document ID is freed for reuse.

**Proposed:** Add clarification that canceled documents (never-effective, v < 1.0) may have their IDs reused per SOP-001 Section 9.7.1.

### 3.5 CR Template - Remove Manual Metadata

**Current template includes:**
```markdown
**Version:** 0.1 (DRAFT)
**Effective Date:** TBD
**Responsible User:** claude

...

## Revision History

| Version | Date | Author | Description |
|---------|------|--------|-------------|
| 0.1 | 2026-01-03 | claude | Initial draft |
```

**Proposed:** Remove these elements from the CR template.

**Rationale:** Per SOP-001 Section 5.4, documents shall NOT contain manually-maintained metadata (version numbers, effective dates, responsible user identifiers, revision history tables). This information is managed by the QMS and available through `qms status` and `qms history` commands.

### 3.6 QA Route Permission

**Current (SOP-001 Section 4.2 Permission Matrix):**

| Action | Initiators | QA | Reviewers |
|--------|------------|-----|-----------|
| route, release, close | Yes | - | - |

**Proposed:**

| Action | Initiators | QA | Reviewers |
|--------|------------|-----|-----------|
| route | Yes | Yes | - |
| release, close | Yes | - | - |

**Rationale:** Enables QA to fast-track approval when no additional reviewers are needed. After QA reviews a document with `--recommend` and determines no TUs are required, QA can immediately route for approval and approve. This eliminates unnecessary round-trips to the Initiator.

**Fast-track workflow:**
1. Initiator routes for review → IN_REVIEW
2. QA reviews with `--recommend` (no TUs needed) → REVIEWED
3. QA routes for approval → IN_APPROVAL
4. QA approves → APPROVED

**Implementation:** Update `ALLOWED_ACTIONS` in qms.py to include `route` for the `qa` user.

### 3.7 Archive Effective Version on Checkout

**Current behavior:**
When an effective document (vN.0) is checked out, creating draft vN.1, the effective version is NOT copied to `.archive/`. The archive only receives versions when they are superseded by a new effective version.

**Problem:**
The `.archive/` directory contains no vN.0 files. If the effective version file is modified during editing, the original approved content is lost.

**Proposed behavior:**
When checkout creates vN.1 from an effective vN.0:
1. Copy the effective version to `.archive/{TYPE}/{DOC_ID}-v{N.0}.md`
2. Then create the draft at vN.1

**Rationale:** Per SOP-001 Section 7.3, "When a document version is superseded... the previous version is copied to `.archive/`". The moment a draft is created, the effective version is conceptually superseded for editing purposes. Archiving immediately preserves the exact approved state before any modifications begin.

**Implementation:** Update `cmd_checkout()` in qms.py to archive the effective version before creating the draft.

## 4. Execution Plan

### Execution
1. Edit qa.md to fix section reference
2. Edit CLAUDE.md to remove incorrect SOP-002 reference
3. Edit bu.md to align effective date
4. Edit SOP-002 to clarify ID reuse policy
5. Edit CR template in qms.py to remove manual metadata fields
6. Checkout SOP-001, update permission matrix to grant QA route permission
7. Update qms.py ALLOWED_ACTIONS to include route for qa user
8. Update qms.py cmd_checkout() to archive effective version before creating draft

## 5. Testing

Manual verification that:
- All section references point to correct sections
- No conflicting statements remain between documents
- Effective dates are consistent across agent files
- New CRs created after template update contain only frontmatter metadata
- QA can successfully execute `qms route` command
- Full fast-track workflow completes successfully
- Checking out an effective document creates archive copy at vN.0

**END OF DOCUMENT**
